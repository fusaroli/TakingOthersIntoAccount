---
title: "Analysis code for Simonsen et al, Taking Others into Account"
author: "Riccardo Fusaroli, Arndis Simonsen & Malte Lau Petersen"
output: html_document
---

```{r options, include=FALSE, message=F, warning=F}
library(knitr)
opts_chunk$set(eval = FALSE, include= TRUE)
```


```{r setup, eval = TRUE, message=F, warning=F}
pacman::p_load(brms,tidyverse,tidybayes,bayesplot,boot,loo,rstan,glue,ggpubr, broom)

```


# Contents
This markdown provides the full code for the manuscript and supplementary materials of the article "Taking Others Into Account"

- Part 0: Load data and libraries
- Part 1: define and fit the naive and weighted bayes, circular inference and glm models, including a diagnostic group parameter
- Part 2: report the models, and perform model comparison
- Part 3: perform hypothesis testing on the best models
- Part 4: include additional parameters in the models (cognitive and clinical features)
- Control analysis 1: multilevel vs. no pooling
- Control analysis 2: model comparison by group
- Control analysis 3: model comparison by participant
- Controls Analysis 4: would the key results hold if we analyzed the participants one by one?
- Controls Analysis 5: running the heuristic model
- Figure 2: Circular inference estimates by diagnosis
- Figure S1: Illustrating effects of different weights on Weighted Bayes
- Figure S2: Illustrating effects of different loops on Circular Inference
- Figure S3: Forest plot of weight and loop parameters by participant in CI
- Figure S4: CI plot by participant

# Experimental context

## Sensory information

k of 8 balls in the bag are red -> coded as logit(k/8)

## Others information
The participants had two pieces of information about the others: how many (out of 4) guessed red, and how confident were those that guessed red and those that guessed green (low vs high confidence).

In order for parameters in the full(er) model(s) to be interpretable as "weight put on evidence from the outside", we split this information to create eight variables, four expressing the choice of one "Other" each, four the confidence of one "Other" each. Since, in the experiment, the face of the Others changed every trial, and no feedback was given, there was no chance for a participant to learn to assign specific weight to a specific other. Accordingly we model all Others with the same coefficients. In each trial, the participant is assumed to combine information from five sources: One from their own perception (12.5% to 87.5%), which is weighted by its own "self" parameter, and four from social sources, which is weighted by a shared "others" parameter.

# Part 0
## Load & pre-process data

```{r load data, eval = TRUE}
# which bounds to truncate "evidence" at 
lower_bound = .1
upper_bound = .9


transform_logit <- function(x, lower = 0.1, upper = 0.9) {
    # "evidence" at more than 90% probability is truncated to 90%
    x[x > upper] = upper
    x[x < lower] = lower
    # .. then transformed to log odds
    return(logit(x))
}

full_data = read_csv("data/data.csv") %>% mutate(
  AnhedoniaS = scale(Anhedonia),
  HallucinationsS = scale(Hallucinations)
)

```

## Stan settings
```{r stan settings, eval = TRUE}
source("scripts/ppc_functions.R")
source("scripts/fit_simplex_priors.R")

N_CORES = 2
ITER = 8e3
STAN_CONTROL = list(
    adapt_delta = .999,
    max_treedepth = 20)

```


# Part 1 - Define and fit models

## Naive Bayes
Two pieces of evidence (a, b) can be combined with bayes rule

`P(x | a,b) = P(x|a) * P(x|b) / (P(x|a) * P(x|b) + (1-P(x|a)) * (1-P(x|b)))`

Or, equivalently, this can be done by adding them on the logit scale

`P(x | a,b) = inv.logit(logit(P(x|a)) + logit(P(x|b)))`

This is the simplest model (Naive Bayes) for what happens when participants combine sensory information (6 out of 8 balls in the bag are red) with social information (1 out of 4 others guessed red).

In this model, there is only one main effect to be estimated, the bias (towards red or green).

There are two versions of the model: one modeling participants as independent from each others and one including potential effects of diagnosis. In this latter model we include the matching of participants (in terms of gender, age, parental education and geographical provenance), replacing the random effect by participant with a random effect of intercent and random slope of diagnosis by subject pair (matched control and participant).


```{r naivebayes, eval = F}

naive_diagnosis_f = bf(ChoiceRed ~ bias + lSelf + lOthers1 + lOthers2 + lOthers3 + lOthers4,
             bias ~ 1 + Diagnosis + (1 +  Diagnosis |p| SubjectPair),
             nl = TRUE)

naive_prior = c(
  prior(normal(0,1), nlpar = "bias"),
  prior(normal(0,1), nlpar = "bias", class="sd")
  )

naive_diagnosis_m = brm(naive_diagnosis_f,
              full_data,
              prior = naive_prior,
              sample_prior = TRUE,
              family = "bernoulli",
              file =  "models/naive_diagnosis_m",
              chains = N_CORES, cores = N_CORES, iter = ITER,
              control = STAN_CONTROL)

naive_diagnosis_m <- add_criterion(naive_diagnosis_m,criterion=c("waic","loo","R2"), file = "models/naive_diagnosis_m")

```


## Weighted Bayes

The next step up is to allow for participants to put a different weight on to different sources of information. Now there are three main parameters: The weight put on evidence coming from one's self (the sensory information, k of 8 balls in the bag are red), and the weight put on evidence from others. This is done with the function defined below: The evidence L (in log odds) is multiplied by the loop strength a and then weighted by the weight w. Here we transform a and w before using them in order to be able to parametrize them in later models.

- Loop strength (used later in the circular inference model) a uses `exp` as its link function to costrain it to be positive. An input of 0 then corresponds to multiplying the evidence by `exp(0) = 1`.
- The weight w need to be on a scale of .5 to 1, so we use a scaled inverted logit transform. Values below 0 or 1 are non-sensical, while values between 0 and .5 implies that evidence counts in the opposite direction. Weight at exactly .5 means that the evidence is not being counted at all. 

```{r F function, eval = TRUE}

F <- function(a_raw, L_raw, w_raw) {
    # weighting function in R
    a = exp(a_raw)
    L = exp(L_raw * a)
    w = inv_logit_scaled(w_raw, 0.5, 1)
    log((w * L + 1 - w)/((1 - w) * L + w))
}

# weighting function in stan
F_stancode = "
real F(real a_raw, real L_raw, real w_raw) {
    real a;
    real L;
    real w;
    a = exp(a_raw);
    L = exp(L_raw * a);
    w = 0.5 + inv_logit(w_raw)/2;
    return log((w * L + 1 - w)./((1 - w) * L + w));
}
"
```


```{r weighted}
weighted_diagnosis_f = bf(ChoiceRed ~ bias + 
                    F(0, lSelf, wSelf) + 
                    F(0, lOthers1noC, wOthers + bConfidence * Confidence1) + 
                    F(0, lOthers2noC, wOthers + bConfidence * Confidence2) + 
                    F(0, lOthers3noC, wOthers + bConfidence * Confidence3) + 
                    F(0, lOthers4noC, wOthers + bConfidence * Confidence4),
                wSelf + wOthers + bConfidence + bias ~ 1 + Diagnosis + (1 +  Diagnosis |p| SubjectPair),
                nl = TRUE)

weighted_prior = c(prior(normal(0,1), nlpar = "wSelf"),
                   prior(normal(0,1), nlpar = "wOthers"),
                   prior(normal(0,1), nlpar = "bConfidence"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(0,.4), nlpar = "wSelf", class="sd"),
                   prior(normal(0,.4), nlpar = "wOthers", class="sd"),
                   prior(normal(0,.4), nlpar = "bConfidence", class="sd"),
                   prior(normal(0,.1), nlpar = "bias", class="sd"))


weighted_diagnosis_m = fit_brm(weighted_diagnosis_f,
                 full_data,
                 stan_funs = F_stancode,
                 prior = weighted_prior,
                 sample_prior = TRUE,
                 family = "bernoulli",
                 file = "models/weighted_diagnosis_m",
                 chains = N_CORES, cores = N_CORES, iter = ITER,
                 control = STAN_CONTROL)

weighted_diagnosis_m <- add_criterion(weighted_diagnosis_m,criterion=c("waic","loo","R2"), file = "models/weighted_diagnosis_m")

```



## Circular Inference

Now we're getting to the circular inference model. The Loop strength parameter, `a`, mentioned above is now a parameter that controls how much incoming information from one source or another reverberates to make what is effectively noise in the system. The base model is still the same: `ChoiceRed ~ bias + F(0, lSelf + I, wSelf) + F(0, lOthers1 + I, wOthers) + [...]`, but now the noise I is included as evidence from all sources `I = F(aSelf, lSelf, wSelf) + F(aOthers, lOthers1, wOthers) + F(aOthers, lOthers2, wOthers) + F(aOthers, lOthers3, wOthers) + F(aOthers, lOthers4, wOthers)`

```{r Circular Inference}

circular_noI_diagnosis_f = bf(ChoiceRed ~ bias + 
                   F(aSelf, lSelf, wSelf) +
                   F(aOthers, lOthers1, wOthers + bConfidence * Confidence1) +
                   F(aOthers, lOthers2, wOthers + bConfidence * Confidence2) +
                   F(aOthers, lOthers3, wOthers + bConfidence * Confidence3) +
                   F(aOthers, lOthers4, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence + bias ~ 1 + Diagnosis + (1 + Diagnosis|p|SubjectPair) ,
               nl = TRUE)

circular_prior = c(prior(normal(0,.3), nlpar = "wSelf"),
                   prior(normal(0,.3), nlpar = "wOthers"),
                   prior(normal(0,.3), nlpar = "aSelf"),
                   prior(normal(0,.3), nlpar = "aOthers"),
                   prior(normal(1,.5), nlpar = "bConfidence"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aSelf", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aOthers", coef = "Intercept"),
                   prior(normal(0, .2), nlpar = "wSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "wOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "aSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "aOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
                   prior(normal(0, .2), nlpar = "bias",class="sd"),
                   prior_("lkj(8)", class = "cor"))

circular_noI_diagnosis_m = fit_brm(circular_noI_diagnosis_f,
               full_data,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file = "models/circular_noI_diagnosis_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_noI_diagnosis_m <- add_criterion(circular_noI_diagnosis_m,criterion=c("waic","loo","R2"), file = "models/circular_noI_diagnosis_m")

circular_diagnosis_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + aSelf + wOthers + aOthers + bConfidence + bias ~ 1 + Diagnosis + (1 + Diagnosis|p|SubjectPair) ,
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(prior(normal(0,.3), nlpar = "wSelf"),
                   prior(normal(0,.3), nlpar = "wOthers"),
                   prior(normal(0,.3), nlpar = "aSelf"),
                   prior(normal(0,.3), nlpar = "aOthers"),
                   prior(normal(1,.5), nlpar = "bConfidence"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aSelf", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aOthers", coef = "Intercept"),
                   prior(normal(0, .2), nlpar = "wSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "wOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "aSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "aOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
                   prior(normal(0, .2), nlpar = "bias",class="sd"),
                   prior_("lkj(8)", class = "cor"))

circular_diagnosis_m = fit_brm(circular_diagnosis_f,
               full_data,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file = "models/circular_diagnosis_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh = 20,
               control = STAN_CONTROL)

circular_diagnosis_m <- add_criterion(circular_diagnosis_m,criterion=c("waic","loo","R2"), file = "models/circular_diagnosis_m")

```

## Now a more traditional GLM analysis

```{r GLM, eval = TRUE}

glm_diagnosis_f = bf(ChoiceRed ~ bias +
                                  bSelf * Self + 
                                  bOthers * (lOthers1noC + lOthers2noC + lOthers3noC + lOthers4noC) +
                                  bConfidence * (Confidence1 * lOthers1noC + Confidence2 * lOthers2noC + Confidence3 * lOthers3noC + Confidence4 * lOthers4noC),
                                  bSelf + bOthers + bConfidence + bias ~ 1 + Diagnosis + (1 + Diagnosis | p | SubjectPair) ,
             nl = TRUE)

glm_prior = c(
  prior(normal(0, .1), nlpar = "bias"),
  prior(normal(0, 1), nlpar = "bSelf"),
  prior(normal(0, 1), nlpar = "bOthers"),
  prior(normal(0, 1), nlpar = "bConfidence"),
  prior(normal(0, .1), nlpar = "bias", class="sd"),
  prior(normal(0, .5), nlpar = "bSelf", class="sd"),
  prior(normal(0, .5), nlpar = "bOthers", class="sd"),
  prior(normal(0, .5), nlpar = "bConfidence", class="sd"))

glm_diagnosis_m = brm(glm_diagnosis_f,
             family="bernoulli",
             data = full_data,
             prior = glm_prior,
             sample_prior = TRUE,
             file= "models/glm_diagnosis_m",
             chains = N_CORES, cores = N_CORES, iter = ITER,
             control = STAN_CONTROL)
glm_diagnosis_m <- add_criterion(glm_diagnosis_m,criterion=c("waic","loo","R2"), file = "models/glm_diagnosis_m")

```


# Part 2: Model comparison

Now, are we warranted in moving on to the most complex model (Circular Inference)?
A first intuition would be to look at the parameters in the Circular Inference model. If the loop strength is equal to zero = exp(-inf), the model makes the same predictions as the simpler weighted model. And if the weights are equal to one = inv_logit_scaled(+inf, 0.5, 1), the predictions are equal to the simplest naive bayes model. But this approach doesn't penalize the more complex model for its complexity.

Instead, we'll use information criteria (PSIS-LOO) to do model comparison. 

```{r Model Comparison}

# Load the models (if you haven't just run the script)
naive_diagnosis_m <- readRDS("models/naive_diagnosis_m.RDS")
weighted_diagnosis_m <- readRDS("models/weighted_diagnosis_m.RDS")
circular_noI_diagnosis_m <- readRDS("models/circular_noI_diagnosis_m.RDS")
circular_diagnosis_m <- readRDS("models/circular_diagnosis_m.RDS")
glm_diagnosis_m <- readRDS("models/glm_diagnosis_m.RDS")

# Report the models
summary(naive_diagnosis_m)
summary(weighted_diagnosis_m)
summary(glm_diagnosis_m)
summary(circular_noI_diagnosis_m)
summary(circular_diagnosis_m)

# Compare the models
Looic_comparison <- loo_compare(naive_diagnosis_m, weighted_diagnosis_m, circular_noI_diagnosis_m, circular_diagnosis_m, glm_diagnosis_m)
print(Looic_comparison)
Looic_weights <- loo_model_weights(naive_diagnosis_m, weighted_diagnosis_m, circular_noI_diagnosis_m, circular_diagnosis_m, glm_diagnosis_m)
print(Looic_weights)


```

## Part 3. Testing hypotheses on the best model

```{r Model Report}

# Test hypotheses
hypothesis(circular_diagnosis_m,"wSelf_Diagnosis > 0")
hypothesis(circular_diagnosis_m,"wOthers_Diagnosis < 0")
hypothesis(circular_diagnosis_m,"aSelf_Diagnosis > 0")
hypothesis(circular_diagnosis_m,"aOthers_Diagnosis < 0")

# Calculate parameters in a more understandable scale
post <- posterior_samples(circular_diagnosis_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept + post$b_bias_Diagnosis)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_Diagnosis)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_Diagnosis)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_Diagnosis)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_Diagnosis)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_Diagnosis)
Diagnosis <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Diagnosis,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Diagnosis) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)
print(Pars[,c("Diagnosis","wSelf_scale","wOthers_scale","wOthersLowConf_scale","aSelf_scale","aOthers_scale")])
```

# Part 4: Cognitive features and symptom models

## Fitting the models

```{r Cognitive Clinical Models}
# IQ model
circular_IQ_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + IQs + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(prior(normal(0,.3), nlpar = "wSelf"),
                   prior(normal(0,.3), nlpar = "wOthers"),
                   prior(normal(0,.3), nlpar = "aSelf"),
                   prior(normal(0,.3), nlpar = "aOthers"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aSelf", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aOthers", coef = "Intercept"),
                   prior(normal(0,.2), coef="IQs", nlpar = "wSelf"),
                   prior(normal(0,.2), coef="IQs", nlpar = "wOthers"),
                   prior(normal(0,.2), coef="IQs", nlpar = "aSelf"),
                   prior(normal(0,.2), coef="IQs", nlpar = "aOthers"),
                   prior(normal(0, .2), nlpar = "wSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "wOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "aSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "aOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "bias",class="sd"),
                   prior(normal(1,.3), nlpar = "bConfidence"),
                   prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
                   prior_("lkj(5)", class = "cor"))

circular_IQ_m = fit_brm(circular_IQ_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_IQ_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,refresh=100,
               control = STAN_CONTROL)

circular_IQ_m <- add_criterion(circular_IQ_m,criterion=c("waic","loo","R2"), file = "models/circular_IQ_m")

## Same evidence for effects of IQ so we run a full analysis

circular_diagnosisIQ_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + aSelf + wOthers + aOthers + bConfidence + bias ~ 1 + Diagnosis + IQs + (1 + Diagnosis +  IQs | p | SubjectPair) ,
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(prior(normal(0,.3), nlpar = "wSelf"),
                   prior(normal(0,.3), nlpar = "wOthers"),
                   prior(normal(0,.3), nlpar = "aSelf"),
                   prior(normal(0,.3), nlpar = "aOthers"),
                   prior(normal(1,.5), nlpar = "bConfidence"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aSelf", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aOthers", coef = "Intercept"),
                   prior(normal(0, .2), nlpar = "wSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "wOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "aSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "aOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
                   prior(normal(0, .2), nlpar = "bias",class="sd"),
                   prior_("lkj(8)", class = "cor"))

circular_diagnosisIQ_m = fit_brm(circular_diagnosisIQ_f,
               full_data,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_diagnosisIQ_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh = 20,
               control = STAN_CONTROL)

circular_diagnosisIQ_m <- add_criterion(circular_diagnosisIQ_m,criterion=c("waic","loo","R2"), file = "models/circular_diagnosisIQ_m")

# WM model
circular_WM_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + WM_Errors + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="WM_Errors", nlpar = "wSelf"),
  prior(normal(0,.2), coef="WM_Errors", nlpar = "wOthers"),
  prior(normal(0,.2), coef="WM_Errors", nlpar = "aSelf"),
  prior(normal(0,.2), coef="WM_Errors", nlpar = "aOthers"),
  prior(normal(0,.2), coef="WM_Errors", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_WM_m = fit_brm(circular_WM_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file = "models/circular_WM_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_WM_m <- add_criterion(circular_WM_confidence_a_m,criterion=c("waic","loo","R2"), file = "models/circular_WM_m")

# IED model
circular_IED_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + IED_Errors + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="IED_Errors", nlpar = "wSelf"),
  prior(normal(0,.2), coef="IED_Errors", nlpar = "wOthers"),
  prior(normal(0,.2), coef="IED_Errors", nlpar = "aSelf"),
  prior(normal(0,.2), coef="IED_Errors", nlpar = "aOthers"),
  prior(normal(0,.2), coef="IED_Errors", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_IED_m = fit_brm(circular_IED_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_IED_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_IED_m <- add_criterion(circular_IED_m,criterion=c("waic","loo","R2"), file = "models/circular_IED_m")

# CPZ model
circular_CPZ_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + CPZ + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="CPZ", nlpar = "wSelf"),
  prior(normal(0,.2), coef="CPZ", nlpar = "wOthers"),
  prior(normal(0,.2), coef="CPZ", nlpar = "aSelf"),
  prior(normal(0,.2), coef="CPZ", nlpar = "aOthers"),
  prior(normal(0,.2), coef="CPZ", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_CPZ_m = fit_brm(circular_CPZ_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_CPZ_m <- add_criterion(circular_CPZ_m,criterion=c("waic","loo","R2"), file = "models/circular_CPZ_m")

# SANS model
circular_SANS_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + SANSs + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="SANSs", nlpar = "wSelf"),
  prior(normal(0,.2), coef="SANSs", nlpar = "wOthers"),
  prior(normal(0,.2), coef="SANSs", nlpar = "aSelf"),
  prior(normal(0,.2), coef="SANSs", nlpar = "aOthers"),
  prior(normal(0,.2), coef="SANSs", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_SANS_m = fit_brm(circular_SANS_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_SANS_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_SANS_m <- add_criterion(circular_SANS_m,criterion=c("waic","loo","R2"), file = "models/circular_SANS_m")

# SAPS model
circular_SAPS_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + SAPSs + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="SAPSs", nlpar = "wSelf"),
  prior(normal(0,.2), coef="SAPSs", nlpar = "wOthers"),
  prior(normal(0,.2), coef="SAPSs", nlpar = "aSelf"),
  prior(normal(0,.2), coef="SAPSs", nlpar = "aOthers"),
  prior(normal(0,.2), coef="SAPSs", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_SAPS_m = fit_brm(circular_SAPS_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_SAPS_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=100,
               control = STAN_CONTROL)

circular_SAPS_m <- add_criterion(circular_SAPS_m,criterion=c("waic","loo","R2"), file = "models/circular_SAPS_m")

# PSP model
circular_PSP_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + PSPs_schizo + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "wSelf"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "wOthers"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "aSelf"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "aOthers"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_PSP_m = fit_brm(circular_PSP_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_PSP_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_PSP_m <- add_criterion(circular_PSP_m,criterion=c("waic","loo","R2"), file = "models/circular_PSP_m")

circular_PSPmo_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + mo(PSP) + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  #prior(normal(0,.2), coef="PSPs_schizo", nlpar = "wSelf"),
  #prior(normal(0,.2), coef="PSPs_schizo", nlpar = "wOthers"),
  #prior(normal(0,.2), coef="PSPs_schizo", nlpar = "aSelf"),
  #prior(normal(0,.2), coef="PSPs_schizo", nlpar = "aOthers"),
  #prior(normal(0,.2), coef="PSPs_schizo", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_PSPmo_m = fit_brm(circular_PSPmo_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_PSP_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_PSPmo_m <- add_criterion(circular_PSPmo_m,criterion=c("waic","loo","R2"), file = "models/circular_PSPmo_m")

## Model the global scores of SAPS
# Hallucinations 
# Delusions
# Bizarre 
# FormalThought
    
## Model the global scores of SANS
# Flattening 
# Avolition 
# Anhedonia 
# Attention                   

full_data <- full_data %>% mutate(
  HallucinationsS = Hallucinations/max(Hallucinations, na.rm=T),
  DelusionsS = Delusions/max(Delusions, na.rm=T),
  BizarreS = Bizarre/max(Bizarre, na.rm=T),
  FormalThoughtS = FormalThought/max(FormalThought, na.rm=T),
  FlatteningS = Flattening /max(Flattening, na.rm=T),
  AvolitionS = Avolition/max(Avolition, na.rm=T),
  AnhedoniaS = Anhedonia/max(Anhedonia, na.rm=T),
  AttentionS = Attention /max(Attention, na.rm=T),
)

# Hallucinations model
circular_Hallucinations_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + HallucinationsS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_Hallucinations_m = fit_brm(circular_Hallucinations_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_Hallucinations_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_Hallucinations_m <- add_criterion(circular_Hallucinations_m,criterion=c("waic","loo","R2"), file = "models/circular_Hallucinations_m")


# Delusions model
circular_Delusions_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + DelusionsS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="DelusionsS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="DelusionsS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="DelusionsS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="DelusionsS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="DelusionsS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_Delusions_m = fit_brm(circular_Delusions_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_Delusions_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_Delusions_m <- add_criterion(circular_Delusions_m,criterion=c("waic","loo","R2"), file = "models/circular_Delusions_m")

# Bizarre Model
# Bizarre model
circular_Bizarre_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + BizarreS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="BizarreS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="BizarreS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="BizarreS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="BizarreS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="BizarreS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_Bizarre_m = fit_brm(circular_Bizarre_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_Bizarre_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_Bizarre_m <- add_criterion(circular_Bizarre_m,criterion=c("waic","loo","R2"), file = "models/circular_Bizarre_m")

## FormalThought Model
# FormalThought model
circular_FormalThought_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + FormalThoughtS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="FormalThoughtS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="FormalThoughtS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="FormalThoughtS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="FormalThoughtS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="FormalThoughtS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_FormalThought_m = fit_brm(circular_FormalThought_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_FormalThought_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_FormalThought_m <- add_criterion(circular_FormalThought_m,criterion=c("waic","loo","R2"), file = "models/circular_FormalThought_m")

# Flattening model
circular_Flattening_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + FlatteningS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="FlatteningS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="FlatteningS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="FlatteningS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="FlatteningS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="FlatteningS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_Flattening_m = fit_brm(circular_Flattening_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_Flattening_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_Flattening_m <- add_criterion(circular_Flattening_m,criterion=c("waic","loo","R2"), file = "models/circular_Flattening_m")

# Avolition model
circular_Avolition_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + AvolitionS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="AvolitionS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="AvolitionS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="AvolitionS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="AvolitionS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="AvolitionS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_Avolition_m = fit_brm(circular_Avolition_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_Avolition_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_Avolition_m <- add_criterion(circular_Avolition_m,criterion=c("waic","loo","R2"), file = "models/circular_Avolition_m")

# Anhedonia model
circular_Anhedonia_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + AnhedoniaS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_Anhedonia_m = fit_brm(circular_Anhedonia_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_Anhedonia_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_Anhedonia_m <- add_criterion(circular_Anhedonia_m,criterion=c("waic","loo","R2"), file = "models/circular_Anhedonia_m")

# Attention model
circular_Attention_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + AttentionS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="AttentionS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="AttentionS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="AttentionS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="AttentionS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="AttentionS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_Attention_m = fit_brm(circular_Attention_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_Attention_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_Attention_m <- add_criterion(circular_Attention_m,criterion=c("waic","loo","R2"), file = "models/circular_Attention_m")

## Anhedonia and Hallucinations
circular_AnhedoniaHallucinations_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + AnhedoniaS + HallucinationsS + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "bConfidence"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)

circular_AnhedoniaHallucinations_m = fit_brm(circular_AnhedoniaHallucinations_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_AnhedoniaHallucinations_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_AnhedoniaHallucinations_m <- add_criterion(circular_AnhedoniaHallucinations_m,criterion=c("waic","loo","R2"), file = "models/circular_AnhedoniaHallucinations_m")

## Plus PSP
circular_AnhedoniaHallucinationsPSP_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence ~ 1 + AnhedoniaS + HallucinationsS + PSPs_schizo + (1|p|Participant),
               bias ~ 1 + (1|Participant),
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="AnhedoniaS", nlpar = "bConfidence"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "wSelf"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "wOthers"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "aSelf"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "aOthers"),
  prior(normal(0,.2), coef="HallucinationsS", nlpar = "bConfidence"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "wSelf"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "wOthers"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "aSelf"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "aOthers"),
  prior(normal(0,.2), coef="PSPs_schizo", nlpar = "bConfidence"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

d <- subset(full_data,Diagnosis==1)
circular_AnhedoniaHallucinationsPSP_m = fit_brm(circular_AnhedoniaHallucinationsPSP_f,
               d,
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_AnhedoniaHallucinationsPSP_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh=20,
               control = STAN_CONTROL)

circular_AnhedoniaHallucinationsPSP_m <- add_criterion(circular_AnhedoniaHallucinationsPSP_m,criterion=c("waic","loo","R2"), file = "models/circular_AnhedoniaHallucinationsPSP_m")
```

## Model comparisons and hypothesis testing to assess the role of clinical and cognitive features

```{r}

circular_schizophrenia_m <- readRDS("models/circular_schizophrenia_m.rds")
circular_IQ_m <- readRDS("models/circular_IQ_m.rds")
circular_WM_m <- readRDS("models/circular_WM_m.rds")
circular_IED_m <- readRDS("models/circular_IED_m.rds")
circular_CPZ_m <- readRDS("models/circular_CPZ_m.rds")
circular_SANS_m <- readRDS("models/circular_SANS_m.rds")
circular_SAPS_m <- readRDS("models/circular_SAPS_m.rds")
circular_PSP_m <- readRDS("models/circular_PSP_m.rds")

circular_Hallucinations_m <- readRDS("models/circular_Hallucinations_m.rds")
circular_Delusions_m <- readRDS("models/circular_Delusions_m.rds")
circular_Bizarre_m <- readRDS("models/circular_Bizarre_m.rds")
circular_FormalThought_m <- readRDS("models/circular_FormalThought_m.rds")
circular_Flattening_m <- readRDS("models/circular_Flattening_m.rds")
circular_Avolition_m <- readRDS("models/circular_Avolition_m.rds")
circular_Anhedonia_m <- readRDS("models/circular_Anhedonia_m.rds")
circular_Attention_m <- readRDS("models/circular_Attention_m.rds")


circular_AnhedoniaHallucinations_m <- readRDS("models/circular_AnhedoniaHallucinations_m.rds")
circular_AnhedoniaHallucinationsPSP_m <- readRDS("models/circular_AnhedoniaHallucinationsPSP_m.rds")

loo_compare(circular_schizophrenia_m,circular_IQ_m,circular_WM_m,circular_IED_m,circular_CPZ_m)
# circular_schizophrenia_m  0.0       0.0   
# circular_CPZ_m           -2.7       2.6   
# circular_IED_m           -2.7       2.5   
# circular_WM_m            -2.9       2.6   
# circular_IQ_m            -3.1       3.1  
loo_model_weights(circular_schizophrenia_m,circular_IQ_m,circular_WM_m,circular_IED_m,circular_CPZ_m)


loo_compare(circular_schizophrenia_m,circular_Flattening_m,circular_SANS_m,circular_Anhedonia_m,circular_Avolition_m,circular_Attention_m)
# circular_schizophrenia_m  0.0       0.0   
# circular_Anhedonia_m     -1.4       2.6   
# circular_SANS_m          -2.0       2.6   
# circular_Avolition_m     -2.2       2.6   
# circular_Flattening_m    -2.6       2.6   
# circular_Attention_m     -2.7       2.6  
loo_model_weights(circular_schizophrenia_m,circular_Flattening_m,circular_SANS_m,circular_Anhedonia_m,circular_Avolition_m,circular_Attention_m)
#                          weight
# circular_schizophrenia_m 0.742 
# circular_Flattening_m    0.000 
# circular_SANS_m          0.008 
# circular_Anhedonia_m     0.250 
# circular_Avolition_m     0.000 
# circular_Attention_m     0.000 

loo_compare(circular_schizophrenia_m,circular_SAPS_m,circular_Hallucinations_m,circular_Delusions_m,circular_Bizarre_m,circular_FormalThought_m)
#                           elpd_diff se_diff
# circular_schizophrenia_m   0.0       0.0   
# circular_Bizarre_m        -1.4       2.4   
# circular_Hallucinations_m -1.5       2.6   
# circular_SAPS_m           -2.0       2.6   
# circular_FormalThought_m  -2.4       2.6   
# circular_Delusions_m      -3.0       2.6 
loo_model_weights(circular_schizophrenia_m,circular_SAPS_m,circular_Hallucinations_m,circular_Delusions_m,circular_Bizarre_m,circular_FormalThought_m)
# 
# circular_schizophrenia_m  0.710 
# circular_SAPS_m           0.000 
# circular_Hallucinations_m 0.290 
# circular_Delusions_m      0.000 
# circular_Bizarre_m        0.000 
# circular_FormalThought_m  0.000 

loo_model_weights(circular_schizophrenia_m,circular_Anhedonia_m,circular_Hallucinations_m)
# circular_schizophrenia_m  0.707 
# circular_Anhedonia_m      0.145 
# circular_Hallucinations_m 0.147 

loo_compare(circular_schizophrenia_m,circular_PSP_m)
loo_model_weights(circular_schizophrenia_m,circular_PSP_m)

loo_compare(circular_schizophrenia_m, circular_IQ_m)
loo_model_weights(circular_schizophrenia_m, circular_IQ_m)
summary(circular_IQ_m)
hypothesis(circular_IQ_m,"wSelf_IQs < 0")
hypothesis(circular_IQ_m,"wOthers_IQs > 0")
hypothesis(circular_IQ_m,"aSelf_IQs < 0")
hypothesis(circular_IQ_m,"aOthers_IQs > 0")
# Calculate estimates
post <- posterior_samples(circular_IQ_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_IQs)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_IQs)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_IQs)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_IQs)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_IQs)
IQ <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(IQ,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(IQ) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)
#
summary(circular_diagnosisIQ_m)
hypothesis(circular_diagnosisIQ_m,"wSelf_Diagnosis > 0")
hypothesis(circular_diagnosisIQ_m,"wOthers_Diagnosis < 0")
hypothesis(circular_diagnosisIQ_m,"aSelf_Diagnosis > 0")
hypothesis(circular_diagnosisIQ_m,"aOthers_Diagnosis < 0")

loo_compare(circular_schizophrenia_m, circular_WM_m)
loo_model_weights(circular_schizophrenia_m, circular_WM_m)
summary(circular_WM_m)
hypothesis(circular_WM_m,"wSelf_WM_Errors < 0")
hypothesis(circular_WM_m,"wOthers_WM_Errors > 0")
hypothesis(circular_WM_m,"aSelf_WM_Errors < 0")
hypothesis(circular_WM_m,"aOthers_WM_Errors > 0")

post <- posterior_samples(circular_WM_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_WM_Errors)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_WM_Errors)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_WM_Errors)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_WM_Errors)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_WM_Errors)
WM <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(WM,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(WM) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)


loo_compare(circular_schizophrenia_m, circular_IED_m)
loo_model_weights(circular_schizophrenia_m, circular_IED_m)
summary(circular_IED_m)
hypothesis(circular_IED_m,"wSelf_IED_Errors < 0")
hypothesis(circular_IED_m,"wOthers_IED_Errors > 0")
hypothesis(circular_IED_m,"aSelf_IED_Errors < 0")
hypothesis(circular_IED_m,"aOthers_IED_Errors > 0")
post <- posterior_samples(circular_IED_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_IED_Errors)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_IED_Errors)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_IED_Errors)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_IED_Errors)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_IED_Errors)
IED <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(IED,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(IED) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)


loo_compare(circular_schizophrenia_m, circular_CPZ_m)
loo_model_weights(circular_schizophrenia_m, circular_CPZ_m)
summary(circular_CPZ_m)
hypothesis(circular_CPZ_m,"wSelf_CPZ > 0")
hypothesis(circular_CPZ_m,"wOthers_CPZ < 0")
hypothesis(circular_CPZ_m,"aSelf_CPZ > 0")
hypothesis(circular_CPZ_m,"aOthers_CPZ < 0")
# Calculate estimates
post <- posterior_samples(circular_CPZ_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_CPZ)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_CPZ)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_CPZ)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_CPZ)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_CPZ)
CPZ <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(CPZ,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(CPZ) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

loo_compare(circular_schizophrenia_m, circular_SANS_m)
loo_model_weights(circular_schizophrenia_m, circular_SANS_m)
summary(circular_SANS_m)
hypothesis(circular_SANS_m,"wSelf_SANSs > 0")
plot(hypothesis(circular_SANS_m,"wSelf_SANSs > 0"))
hypothesis(circular_SANS_m,"wOthers_SANSs < 0")
plot(hypothesis(circular_SANS_m,"wOthers_SANSs < 0"))
hypothesis(circular_SANS_m,"aSelf_SANSs > 0")
plot(hypothesis(circular_SANS_m,"aSelf_SANSs > 0"))
hypothesis(circular_SANS_m,"aOthers_SANSs < 0")
plot(hypothesis(circular_SANS_m,"aOthers_SANSs < 0"))
# Calculate estimates
post <- posterior_samples(circular_SANS_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_SANSs)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_SANSs)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_SANSs)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_SANSs)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_SANSs)
SANS <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(SANS,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(SANS) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

loo_compare(circular_schizophrenia_m, circular_SAPS_m)
loo_model_weights(circular_schizophrenia_m, circular_SAPS_m)
summary(circular_SAPS_m)
hypothesis(circular_SAPS_m,"wSelf_SAPSs > 0")
hypothesis(circular_SAPS_m,"wOthers_SAPSs < 0")
hypothesis(circular_SAPS_m,"aSelf_SAPSs > 0")
hypothesis(circular_SAPS_m,"aOthers_SAPSs < 0")

# Calculate estimates
post <- posterior_samples(circular_SAPS_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_SAPSs)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_SAPSs)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_SAPSs)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_SAPSs)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_SAPSs)
SAPS <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(SAPS,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(SAPS) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

loo_compare(circular_schizophrenia_m, circular_PSP_m, ic="loo")
loo_model_weights(circular_schizophrenia_m, circular_PSP_m, ic="loo")
summary(circular_PSP_m)
hypothesis(circular_PSP_m,"wSelf_PSPs_schizo < 0")
hypothesis(circular_PSP_m,"wOthers_PSPs_schizo > 0")
hypothesis(circular_PSP_m,"aSelf_PSPs_schizo < 0")
hypothesis(circular_PSP_m,"aOthers_PSPs_schizo > 0")

post <- posterior_samples(circular_PSP_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_PSPs_schizo)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_PSPs_schizo)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_PSPs_schizo)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_PSPs_schizo)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_PSPs_schizo)
PSP <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(PSP,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(PSP) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)


### Hallucinations
loo_compare(circular_schizophrenia_m, circular_Hallucinations_m)
loo_model_weights(circular_schizophrenia_m, circular_Hallucinations_m)
summary(circular_Hallucinations_m)
hypothesis(circular_Hallucinations_m,"wSelf_HallucinationsS > 0")
hypothesis(circular_Hallucinations_m,"wOthers_HallucinationsS < 0")
hypothesis(circular_Hallucinations_m,"aSelf_HallucinationsS > 0")
plot(hypothesis(circular_Hallucinations_m,"aSelf_HallucinationsS > 0"))
hypothesis(circular_Hallucinations_m,"aOthers_HallucinationsS < 0")

post <- posterior_samples(circular_Hallucinations_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_HallucinationsS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_HallucinationsS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_HallucinationsS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_HallucinationsS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_HallucinationsS)
Hallucinations <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Hallucinations,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Hallucinations) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### Delusions
loo_compare(circular_schizophrenia_m, circular_Delusions_m)
loo_model_weights(circular_schizophrenia_m, circular_Delusions_m)
summary(circular_Delusions_m)
hypothesis(circular_Delusions_m,"wSelf_DelusionsS > 0")
hypothesis(circular_Delusions_m,"wOthers_DelusionsS < 0")
hypothesis(circular_Delusions_m,"aSelf_DelusionsS > 0")
plot(hypothesis(circular_Delusions_m,"aSelf_DelusionsS > 0"))
hypothesis(circular_Delusions_m,"aOthers_DelusionsS < 0")

post <- posterior_samples(circular_Delusions_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_DelusionsS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_DelusionsS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_DelusionsS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_DelusionsS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_DelusionsS)
Delusions <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Delusions,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Delusions) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### Bizarre
loo_compare(circular_schizophrenia_m, circular_Bizarre_m)
loo_model_weights(circular_schizophrenia_m, circular_Bizarre_m)
summary(circular_Bizarre_m)
hypothesis(circular_Bizarre_m,"wSelf_BizarreS > 0")
hypothesis(circular_Bizarre_m,"wOthers_BizarreS < 0")
hypothesis(circular_Bizarre_m,"aSelf_BizarreS > 0")
plot(hypothesis(circular_Bizarre_m,"aSelf_BizarreS > 0"))
hypothesis(circular_Bizarre_m,"aOthers_BizarreS < 0")

post <- posterior_samples(circular_Bizarre_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_BizarreS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_BizarreS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_BizarreS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_BizarreS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_BizarreS)
Bizarre <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Bizarre,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Bizarre) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### FormalThought
loo_compare(circular_schizophrenia_m, circular_FormalThought_m)
loo_model_weights(circular_schizophrenia_m, circular_FormalThought_m)
summary(circular_FormalThought_m)
hypothesis(circular_FormalThought_m,"wSelf_FormalThoughtS > 0")
hypothesis(circular_FormalThought_m,"wOthers_FormalThoughtS < 0")
hypothesis(circular_FormalThought_m,"aSelf_FormalThoughtS > 0")
plot(hypothesis(circular_FormalThought_m,"aSelf_FormalThoughtS > 0"))
hypothesis(circular_FormalThought_m,"aOthers_FormalThoughtS < 0")

post <- posterior_samples(circular_FormalThought_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_FormalThoughtS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_FormalThoughtS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_FormalThoughtS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_FormalThoughtS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_FormalThoughtS)
FormalThought <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(FormalThought,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(FormalThought) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### Flattening
loo_compare(circular_schizophrenia_m, circular_Flattening_m)
loo_model_weights(circular_schizophrenia_m, circular_Flattening_m)
summary(circular_Flattening_m)
hypothesis(circular_Flattening_m,"wSelf_FlatteningS > 0")
hypothesis(circular_Flattening_m,"wOthers_FlatteningS < 0")
hypothesis(circular_Flattening_m,"aSelf_FlatteningS > 0")
plot(hypothesis(circular_Flattening_m,"aSelf_FlatteningS > 0"))
hypothesis(circular_Flattening_m,"aOthers_FlatteningS < 0")

post <- posterior_samples(circular_Flattening_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_FlatteningS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_FlatteningS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_FlatteningS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_FlatteningS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_FlatteningS)
Flattening <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Flattening,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Flattening) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### Avolition
loo_compare(circular_schizophrenia_m, circular_Avolition_m)
loo_model_weights(circular_schizophrenia_m, circular_Avolition_m)
summary(circular_Avolition_m)
hypothesis(circular_Avolition_m,"wSelf_AvolitionS > 0")
hypothesis(circular_Avolition_m,"wOthers_AvolitionS < 0")
hypothesis(circular_Avolition_m,"aSelf_AvolitionS > 0")
plot(hypothesis(circular_Avolition_m,"aSelf_AvolitionS > 0"))
hypothesis(circular_Avolition_m,"aOthers_AvolitionS < 0")

post <- posterior_samples(circular_Avolition_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_AvolitionS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_AvolitionS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_AvolitionS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_AvolitionS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_AvolitionS)
Avolition <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Avolition,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Avolition) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### Anhedonia
loo_compare(circular_schizophrenia_m, circular_Anhedonia_m)
loo_model_weights(circular_schizophrenia_m, circular_Anhedonia_m)
summary(circular_Anhedonia_m)
hypothesis(circular_Anhedonia_m,"wSelf_AnhedoniaS > 0")
hypothesis(circular_Anhedonia_m,"wOthers_AnhedoniaS < 0")
hypothesis(circular_Anhedonia_m,"aSelf_AnhedoniaS > 0")
plot(hypothesis(circular_Anhedonia_m,"aSelf_AnhedoniaS > 0"))
hypothesis(circular_Anhedonia_m,"aOthers_AnhedoniaS < 0")

post <- posterior_samples(circular_Anhedonia_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_AnhedoniaS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_AnhedoniaS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_AnhedoniaS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_AnhedoniaS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_AnhedoniaS)
Anhedonia <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Anhedonia,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Anhedonia) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### Attention
loo_compare(circular_schizophrenia_m, circular_Attention_m)
loo_model_weights(circular_schizophrenia_m, circular_Attention_m)
summary(circular_Attention_m)
hypothesis(circular_Attention_m,"wSelf_AttentionS > 0")
hypothesis(circular_Attention_m,"wOthers_AttentionS < 0")
hypothesis(circular_Attention_m,"aSelf_AttentionS > 0")
plot(hypothesis(circular_Attention_m,"aSelf_AttentionS > 0"))
hypothesis(circular_Attention_m,"aOthers_AttentionS < 0")

post <- posterior_samples(circular_Attention_m)
bias <- c(post$b_bias_Intercept, post$b_bias_Intercept)
bConfidence <- c(post$b_bConfidence_Intercept, post$b_bConfidence_Intercept + post$b_bConfidence_AttentionS)
wSelf <- c(post$b_wSelf_Intercept, post$b_wSelf_Intercept + post$b_wSelf_AttentionS)
wOthers <- c(post$b_wOthers_Intercept, post$b_wOthers_Intercept + post$b_wOthers_AttentionS)
aSelf <- c(post$b_aSelf_Intercept, post$b_aSelf_Intercept + post$b_aSelf_AttentionS)
aOthers <- c(post$b_aOthers_Intercept, post$b_aOthers_Intercept + post$b_aOthers_AttentionS)
Attention <- c(  rep(0,each=8000),  rep(1,each=8000)) 
xxx <- data.frame(Attention,wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
Pars <- xxx %>% group_by(Attention) %>% 
  dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
Pars$wSelf_scale <- inv_logit_scaled(Pars$wSelf, 0.5, 1)
Pars$wOthers_scale <- inv_logit_scaled(Pars$wOthers + Pars$bConfidence, 0.5, 1)
Pars$wOthersLowConf_scale <- inv_logit_scaled(Pars$wOthers + (Pars$bConfidence*0.5), 0.5, 1)
Pars$aSelf_scale <- exp(Pars$aSelf)
Pars$aOthers_scale <- exp(Pars$aOthers)

### AnhedoniHallucinations
loo_compare(circular_schizophrenia_m, circular_AnhedoniaHallucinations_m)
loo_model_weights(circular_schizophrenia_m, circular_AnhedoniaHallucinations_m)
summary(circular_AnhedoniaHallucinations_m)
hypothesis(circular_AnhedoniaHallucinations_m,"wSelf_AnhedoniaS > 0")
hypothesis(circular_AnhedoniaHallucinations_m,"wOthers_AnhedoniaS < 0")
hypothesis(circular_AnhedoniaHallucinations_m,"aSelf_AnhedoniaS > 0")
hypothesis(circular_AnhedoniaHallucinations_m,"aOthers_AnhedoniaS < 0")
hypothesis(circular_AnhedoniaHallucinations_m,"wSelf_HallucinationsS > 0")
hypothesis(circular_AnhedoniaHallucinations_m,"wOthers_HallucinationsS < 0")
hypothesis(circular_AnhedoniaHallucinations_m,"aSelf_HallucinationsS > 0")
hypothesis(circular_AnhedoniaHallucinations_m,"aOthers_HallucinationsS < 0")

post <- posterior_samples(circular_AnhedoniaHallucinations_m)

aSelf_base <- exp(post$b_aSelf_Intercept)
aSelf_Anhedonia <- exp(post$b_aSelf_Intercept + post$b_aSelf_AnhedoniaS)
aSelf_Hallucinations <- exp(post$b_aSelf_Intercept + post$b_aSelf_HallucinationsS)
aSelf_AnhedoniaHallucinations <- exp(post$b_aSelf_Intercept + post$b_aSelf_AnhedoniaS + post$b_aSelf_HallucinationsS)

mean(aSelf_base)
mean(aSelf_Anhedonia)
mean(aSelf_Hallucinations)
mean(aSelf_AnhedoniaHallucinations)

loo_compare(circular_schizophrenia_m, circular_AnhedoniaHallucinations_m, circular_AnhedoniaHallucinationsPSP_m)
loo_model_weights(circular_schizophrenia_m, circular_AnhedoniaHallucinations_m, circular_AnhedoniaHallucinationsPSP_m)

summary(circular_AnhedoniaHallucinationsPSP_m)
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"wSelf_AnhedoniaS > 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"wOthers_AnhedoniaS < 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"aSelf_AnhedoniaS > 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"aOthers_AnhedoniaS < 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"wSelf_HallucinationsS > 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"wOthers_HallucinationsS < 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"aSelf_HallucinationsS > 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"aOthers_HallucinationsS < 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"wSelf_PSPs_schizo > 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"wOthers_PSPs_schizo < 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"aSelf_PSPs_schizo > 0")
hypothesis(circular_AnhedoniaHallucinationsPSP_m,"aOthers_PSPs_schizo < 0")

post <- posterior_samples(circular_AnhedoniaHallucinationsPSP_m)

aSelf_base <- exp(post$b_aSelf_Intercept)
aSelf_Anhedonia <- exp(post$b_aSelf_Intercept + post$b_aSelf_AnhedoniaS)
aSelf_Hallucinations <- exp(post$b_aSelf_Intercept + post$b_aSelf_HallucinationsS)
aSelf_PSP <- exp(post$b_aSelf_Intercept + post$b_aSelf_PSPs_schizo)
aSelf_AnhedoniaHallucinations <- exp(post$b_aSelf_Intercept + post$b_aSelf_AnhedoniaS + post$b_aSelf_HallucinationsS)
aSelf_AnhedoniaHallucinationsPSP <- exp(post$b_aSelf_Intercept + post$b_aSelf_AnhedoniaS + post$b_aSelf_HallucinationsS+ post$b_aSelf_PSPs_schizo)

mean(aSelf_base)
mean(aSelf_Anhedonia)
mean(aSelf_Hallucinations)
mean(aSelf_PSP)
mean(aSelf_AnhedoniaHallucinations)
mean(aSelf_AnhedoniaHallucinationsPSP)

```

# Control analyses

## Control analysis 1: Testing whether the no-pooling model would fare better than multilevel

```{r}
## No pooling

full_data$Subject=as.factor(full_data$Subject)

circular_nopooling_prior = c(
                   prior(normal(1,.5), nlpar = "bConfidence"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(1,1), nlpar = "wSelf"),
                   prior(normal(1,1), nlpar = "wOthers"),
                   prior(normal(0,1), nlpar = "aSelf"),
                   prior(normal(0,1), nlpar = "aOthers"))

circular_nopooling_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + aSelf + wOthers + aOthers + bConfidence + bias ~ 0 + Subject ,
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_nopooling_m = brm(circular_nopooling_f,
               full_data,
               stan_funs = F_stancode,
               prior = circular_nopooling_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file = "models/circular_nopooling_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh = 20,
               control = STAN_CONTROL)

circular_nopooling_m <- add_criterion(circular_nopooling_m,criterion=c("waic","loo","R2"), file = "models/circular_nopooling_m")

```

### Model comparison

```{r}
circular_nopooling_m <- readRDS("models/circular_nopooling_m.RDS")
loo_model_weights(circular_diagnosis_m, circular_nopooling_m)

```


## Control analysis 2: Testing whether the single groups have the same ranking

```{r}
# Adding model by group for control analysis

weighted_f = bf(ChoiceRed ~ bias + 
                    F(0, lSelf, wSelf) + 
                    F(0, lOthers1noC, wOthers + bConfidence * Confidence1) + 
                    F(0, lOthers2noC, wOthers + bConfidence * Confidence2) + 
                    F(0, lOthers3noC, wOthers + bConfidence * Confidence3) + 
                    F(0, lOthers4noC, wOthers + bConfidence * Confidence4),
                wSelf + wOthers + bConfidence + bias ~ 1 + (1|p|Participant),
                nl = TRUE)

weighted_prior = c(prior(normal(0,1), nlpar = "wSelf"),
                   prior(normal(0,1), nlpar = "wOthers"),
                   prior(normal(1,1), nlpar = "bConfidence"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(0,.4), nlpar = "wSelf", class="sd"),
                   prior(normal(0,.4), nlpar = "wOthers", class="sd"),
                   prior(normal(0,.4), nlpar = "bConfidence", class="sd"),
                   prior(normal(0,.1), nlpar = "bias", class="sd"),
                   prior_("lkj(8)", class = "cor"))

weighted_schizophrenia_m = brm(weighted_f,
                 subset(full_data,Diagnosis==1),
                 stan_funs = F_stancode,
                 prior = weighted_prior,
                 sample_prior = TRUE,
                 family = "bernoulli",
                 file = "models/weighted_schizophrenia_m",
                 chains = N_CORES, cores = N_CORES, iter = ITER,
                 control = STAN_CONTROL)

weighted_schizophrenia_m <- add_criterion(weighted_schizophrenia_m,criterion=c("waic","loo","R2"), file = "models/weighted_schizophrenia_m")

weighted_controls_m = brm(weighted_f,
                 subset(full_data,Diagnosis==0),
                 stan_funs = F_stancode,
                 prior = weighted_prior,
                 sample_prior = TRUE,
                 family = "bernoulli",
                 file = "models/weighted_controls_m",
                 chains = N_CORES, cores = N_CORES, iter = ITER,
                 control = STAN_CONTROL)

weighted_controls_m <- add_criterion(weighted_controls_m,criterion=c("waic","loo","R2"), file = "models/weighted_controls_m")

circular_noI_byGroup_f = bf(ChoiceRed ~ bias + 
                   F(aSelf, lSelf, wSelf) +
                   F(aOthers, lOthers1, wOthers + bConfidence * Confidence1) +
                   F(aOthers, lOthers2, wOthers + bConfidence * Confidence2) +
                   F(aOthers, lOthers3, wOthers + bConfidence * Confidence3) +
                   F(aOthers, lOthers4, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence + bias ~ 1 + (1 | p | SubjectPair) ,
               nl = TRUE)

circular_prior = c(prior(normal(0,.3), nlpar = "wSelf"),
                   prior(normal(0,.3), nlpar = "wOthers"),
                   prior(normal(0,.3), nlpar = "aSelf"),
                   prior(normal(0,.3), nlpar = "aOthers"),
                   prior(normal(1,.5), nlpar = "bConfidence"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aSelf", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aOthers", coef = "Intercept"),
                   prior(normal(0, .2), nlpar = "wSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "wOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "aSelf",class="sd"),
                   prior(normal(0, .2), nlpar = "aOthers",class="sd"),
                   prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
                   prior(normal(0, .2), nlpar = "bias",class="sd"),
                   prior_("lkj(8)", class = "cor"))

circular_noI_controls_m = fit_brm(circular_noI_byGroup_f,
               subset(full_data,Diagnosis==0),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_noI_controls_m <- add_criterion(circular_controls_noI_m,criterion=c("waic","loo","R2"), file = "models/circular_noI_controls_m")

circular_noI_schizophrenia_m = fit_brm(circular_noI_byGroup_f,
               subset(full_data,Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file = "models/circular_noI_schizophrenia_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)

circular_noI_schizophrenia_m <- add_criterion(circular_noI_schizophrenia_m,criterion=c("waic","loo","R2"), file = "models/circular_noI_schizophrenia_m")

circular_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bias + bConfidence ~ 1 + (1|p|Participant) ,
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(
  prior(normal(0,.3), nlpar = "wSelf"),
  prior(normal(0,.3), nlpar = "wOthers"),
  prior(normal(0,.3), nlpar = "aSelf"),
  prior(normal(0,.3), nlpar = "aOthers"),
  prior(normal(0,.1), nlpar = "bias"),
  prior(normal(1,.2), nlpar = "bConfidence"),
  prior(normal(1,1.5), nlpar = "wSelf", coef = "Intercept"),
  prior(normal(1,1.5), nlpar = "wOthers", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aSelf", coef = "Intercept"),
  prior(normal(0,1.5), nlpar = "aOthers", coef = "Intercept"),
  prior(normal(0, .2), nlpar = "wSelf",class="sd"),
  prior(normal(0, .2), nlpar = "wOthers",class="sd"),
  prior(normal(0, .2), nlpar = "aSelf",class="sd"),
  prior(normal(0, .2), nlpar = "aOthers",class="sd"),
  prior(normal(0, .2), nlpar = "bConfidence",class="sd"),
  prior(normal(0, .2), nlpar = "bias",class="sd"),
  prior_("lkj(8)", class = "cor"))

circular_schizophrenia_m = fit_brm(circular_f,
               subset(full_data, Diagnosis==1),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file = "models/circular_schizophrenia_m",
               chains = N_CORES, cores = N_CORES, iter = ITER, refresh = 20,
               control = STAN_CONTROL)
circular_schizophrenia_m <- add_criterion(circular_schizophrenia_m,criterion=c("waic","loo","R2"), file = "models/circular_schizophrenia_m")

circular_controls_m = fit_brm(circular_f,
               subset(full_data, Diagnosis==0),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli", 
               file = "models/circular_controls_m",
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)
circular_controls_m <- add_criterion(circular_controls_m,criterion=c("waic","loo","R2"), file = "models/circular_controls_m")

## By group
glm_f = bf(ChoiceRed ~ bias + 
             bSelf * Self + 
             bOthers * (lOthers1noC + lOthers2noC + lOthers3noC + lOthers4noC) +
             bConfidence * (Confidence1 * lOthers1noC + Confidence2 * lOthers2noC + Confidence3 * lOthers3noC + Confidence4 * lOthers4noC),
             bSelf + bOthers + bConfidence + bias ~ 1 + (1 | p | Participant) ,
             nl = TRUE)


glm_prior = c(
  prior(normal(0, .1), nlpar = "bias"),
  prior(normal(0, 1), nlpar = "bSelf"),
  prior(normal(0, 1), nlpar = "bOthers"),
  prior(normal(0, 1), nlpar = "bConfidence"),
  prior(normal(0, .1), nlpar = "bias", class="sd"),
  prior(normal(0, .5), nlpar = "bSelf", class="sd"),
  prior(normal(0, .5), nlpar = "bOthers", class="sd"),
  prior(normal(0, .5), nlpar = "bConfidence", class="sd"))

glm_schizophrenia_m = brm(glm_f,
             family="bernoulli",
             data = subset(full_data,Diagnosis==1),
             prior = glm_prior,
             sample_prior = TRUE,
             file = "models/glm_schizophrenia_m",
             chains = N_CORES, cores = N_CORES, iter = ITER,
             control = STAN_CONTROL)
glm_schizophrenia_m <- add_criterion(glm_schizophrenia_m,criterion=c("waic","loo","R2"), file = "models/glm_schizophrenia_m")

glm_controls_m = brm(glm_f,
             family="bernoulli",
             data = subset(full_data,Diagnosis==0),
             prior = glm_prior,
             sample_prior = TRUE,
             file = "models/glm_controls_m",
             chains = N_CORES, cores = N_CORES, iter = ITER,
             control = STAN_CONTROL)
glm_controls_m <- add_criterion(glm_controls_m,criterion=c("waic","loo","R2"), file = "models/glm_controls_m")
```

# Now model comparison

```{r}
naive_schizophrenia_m <- readRDS("models/naive_schizophrenia_m.RDS")
naive_controls_m <- readRDS("models/naive_controls_m.RDS")
weighted_schizophrenia_m <- readRDS("models/weighted_schizophrenia_m.RDS")
weighted_controls_m <- readRDS("models/weighted_controls_m.RDS")
circular_noI_controls_m <- readRDS("models/circular_noI_controls_m.RDS")
circular_noI_schizophrenia_m <- readRDS("models/circular_noI_schizophrenia_m.RDS")
circular_controls_m <- readRDS("models/circular_controls_m.RDS")
circular_schizophrenia_m <- readRDS("models/circular_schizophrenia_m.RDS")
glm_controls_m <- readRDS("models/glm_controls_m.RDS")
glm_schizophrenia_m <- readRDS("models/glm_schizophrenia_m.RDS")

### Schizophrenia
Looic_comparison <- loo_compare(naive_schizophrenia_m, weighted_schizophrenia_m, circular_noI_schizophrenia_m, circular_schizophrenia_m, glm_schizophrenia_m)
print(Looic_comparison)
Looic_weights <- loo_model_weights(naive_schizophrenia_m, weighted_schizophrenia_m, circular_noI_schizophrenia_m, circular_schizophrenia_m, glm_schizophrenia_m)
print(Looic_weights)

### Controls
Looic_comparison <- loo_compare(naive_controls_m, weighted_controls_m, circular_noI_controls_m, circular_controls_m, glm_controls_m)
print(Looic_comparison)
Looic_weights <- loo_model_weights(naive_controls_m, weighted_controls_m, circular_noI_controls_m, circular_controls_m, glm_controls_m)
print(Looic_weights)
```

## Control analysis 3: Participant by participant model comparison

```{r}
N_CORES = 2
ITER = 2e3
STAN_CONTROL = list(
    adapt_delta = .999,
    max_treedepth = 20)


naive_participant_f = bf(ChoiceRed ~ bias + lSelf + lOthers1 + lOthers2 + lOthers3 + lOthers4,
             bias ~ 1,
             nl = TRUE)

naive_prior = c(
  prior(normal(0,1), nlpar = "bias")
  )

weighted_participant_f = bf(ChoiceRed ~ bias + 
                    F(0, lSelf, wSelf) + 
                    F(0, lOthers1noC, wOthers + bConfidence * Confidence1) + 
                    F(0, lOthers2noC, wOthers + bConfidence * Confidence2) + 
                    F(0, lOthers3noC, wOthers + bConfidence * Confidence3) + 
                    F(0, lOthers4noC, wOthers + bConfidence * Confidence4),
                wSelf + wOthers + bConfidence + bias ~ 1,
                nl = TRUE)

weighted_prior = c(prior(normal(0,1), nlpar = "bConfidence"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"), 
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,.1), nlpar = "bias"))

circular_noI_participant_f = bf(ChoiceRed ~ bias + 
                   F(aSelf, lSelf, wSelf) +
                   F(aOthers, lOthers1, wOthers + bConfidence * Confidence1) +
                   F(aOthers, lOthers2, wOthers + bConfidence * Confidence2) +
                   F(aOthers, lOthers3, wOthers + bConfidence * Confidence3) +
                   F(aOthers, lOthers4, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bConfidence + bias ~ 1 ,
               nl = TRUE)

circular_participant_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bias + bConfidence ~ 1,
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

circular_prior = c(prior(normal(1,.5), nlpar = "bConfidence"),
                   prior(normal(0,.1), nlpar = "bias"),
                   prior(normal(1,1), nlpar = "wSelf", coef = "Intercept"),
                   prior(normal(1,1), nlpar = "wOthers", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aSelf", coef = "Intercept"),
                   prior(normal(0,1), nlpar = "aOthers", coef = "Intercept"))

glm_participant_f = bf(ChoiceRed ~ bias + 
             bSelf * Self + 
             bOthers * (lOthers1noC + lOthers2noC + lOthers3noC + lOthers4noC) +
             bConfidence * (Confidence1 * lOthers1noC + Confidence2 * lOthers2noC + Confidence3 * lOthers3noC + Confidence4 * lOthers4noC),
             bSelf + bOthers + bConfidence + bias ~ 1 ,
             nl = TRUE)


glm_prior = c(
  prior(normal(0, .1), nlpar = "bias"),
  prior(normal(0, 1), nlpar = "bSelf"),
  prior(normal(0, 1), nlpar = "bOthers"),
  prior(normal(0, 1), nlpar = "bConfidence"))

heuristic_participant_f = bf(ChoiceRed ~ bias + 
             bSelf * Self + 
             HeuristicSelf * (bOthers * HeuristicOther),
             bSelf + bOthers + bias ~ 1,
             nl = TRUE)

heuristic_prior = c(
  prior(normal(0, 0.1), nlpar = "bias"),
  prior(normal(0, 1), nlpar = "bSelf"),
  prior(normal(0, 1), nlpar = "bOthers"))


for (participant in unique(full_data$Subject)){
  print(participant)
  
  naive_participant_m = brm(naive_participant_f,
                subset(full_data,Subject==participant),
                prior = naive_prior,
                sample_prior = TRUE,
                family = "bernoulli",
                file=paste0("models/ByParticipant/Naive_S",participant,"_m"),
                chains = N_CORES, cores = N_CORES, iter = ITER,
                control = STAN_CONTROL)
  naive_participant_m <- add_criterion(naive_participant_m, 
                                       criterion=c("waic","loo","R2"), file=paste0("models/ByParticipant/Naive_S",participant,"_m"))
  
  weighted_participant_m = brm(weighted_participant_f,
                 subset(full_data,Subject==participant),
                 stan_funs = F_stancode,
                 prior = weighted_prior,
                 sample_prior = TRUE,
                 family = "bernoulli",
                 file=paste0("models/ByParticipant/Weighted_S",participant,"_m"),
                 chains = N_CORES, cores = N_CORES, iter = ITER,
                 control = STAN_CONTROL)

  weighted_participant_m <- add_criterion(weighted_participant_m,
                                          criterion=c("waic","loo","R2"), file=paste0("models/ByParticipant/Weighted_S",participant,"_m"))
  
  circular_noI_participant_m = brm(circular_noI_participant_f,
               subset(full_data,Subject==participant),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file=paste0("models/ByParticipant/CircularNoI_S",participant,"_m"),
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)
  circular_noI_participant_m <- add_criterion(circular_noI_participant_m,
                                              criterion=c("waic","loo","R2"),file=paste0("models/ByParticipant/CircularNoI_S",participant,"_m"))

  circular_participant_m = brm(circular_participant_f,
               subset(full_data,Subject==participant),
               stan_funs = F_stancode,
               prior = circular_prior,
               sample_prior = TRUE,
               family = "bernoulli",
               file=paste0("models/ByParticipant/Circular_S",participant,"_m"),
               chains = N_CORES, cores = N_CORES, iter = ITER,
               control = STAN_CONTROL)
  circular_participant_m <- add_criterion(circular_participant_m,
                                          criterion=c("waic","loo","R2"), file=paste0("models/ByParticipant/Circular_S",participant,"_m"))
  
  glm_participant_m = brm(glm_participant_f,
             family="bernoulli",
             subset(full_data,Subject==participant),
             prior = glm_prior,
             sample_prior = TRUE,
             file=paste0("models/ByParticipant/GLM_S",participant,"_m"),
             chains = N_CORES, cores = N_CORES, iter = ITER,
             control = STAN_CONTROL)
  glm_participant_m <- add_criterion(glm_participant_m,
                                     criterion=c("waic","loo","R2"), file = paste0("models/ByParticipant/GLM_S",participant,"_m"))
  

  heuristic_participant_m = brm(heuristic_participant_f,
             family="bernoulli",
             subset(full_data,Subject==participant),
             prior = heuristic_prior,
             sample_prior = TRUE,
             file=paste0("models/ByParticipant/Heuristic_S",participant,"_m"),
             chains = N_CORES, cores = N_CORES, iter = ITER,
             control = STAN_CONTROL)
  
  heuristic_participant_m <- add_criterion(heuristic_participant_m,
                                     criterion=c("waic","loo","R2"), file = paste0("models/ByParticipant/Heuristic_S",participant,"_m"))

  
  modelweights<-loo_model_weights(
    naive_participant_m,weighted_participant_m,
    circular_noI_participant_m,circular_participant_m,
    glm_participant_m, heuristic_participant_m)
  
  print(modelweights)
  write_rds(modelweights, path=paste0("models/S",participant,"_weights"))
  
}

```

## Controls Analysis 4: would the results hold if we analyzed the participants one by one?

```{r}
circular_nopooling_m <- readRDS("models/circular_nopooling_m.RDS")

## Extract the parameters by participant from the no-pooling model
x <- tidy(circular_nopooling_m)
x$Diagnosis <- "Schizophrenia"
x$Diagnosis[parse_number(x$term)>199] <- "Controls"
x$ID <- parse_number(x$term)
x$parameter <- NA

x$parameter[grepl("wSelf",x$term)]<-"wSelf"
x$parameter[grepl("wOther",x$term)]<-"wOther"
x$parameter[grepl("aOther",x$term)]<-"aOther"
x$parameter[grepl("aSelf",x$term)]<-"aSelf"
ggplot(subset(x,!is.na(parameter)),aes(Diagnosis,estimate,color=Diagnosis)) + geom_point()+facet_wrap(parameter~.)

xx <- 
  x %>%
  subset(!is.na(parameter)) %>%
  select(estimate,ID,Diagnosis,parameter) %>% 
  spread(parameter,estimate)

MultiVariate_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ Diagnosis +  (1+Diagnosis|p|ID)
)

get_prior(MultiVariate_f,xx,family=gaussian)

prior <- c(
  prior(normal(0,0.3),class=Intercept),
  prior(normal(0,0.3),class=b),
  prior(lkj(5),class=cor),
  prior(normal(0,0.1),class=sd, resp=wSelf),
  prior(normal(0,0.1),class=sd, resp=wOther),
  prior(normal(0,0.1),class=sd, resp=aSelf),
  prior(normal(0,0.1),class=sd, resp=aOther)
)

m <- brm(MultiVariate_f,
         data = xx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mDiagnosis",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))



# checking for SANS/SAPS/PSP
xxx <- xx %>% subset(Diagnosis=="Schizophrenia")
Demo <- full_data %>% group_by(Subject) %>% summarize(
  SANS = SANS[1],
  SAPS = SAPS[1],
  PSP = PSP[1],
  Hallucinations = Hallucinations[1],
  Delusions = Delusions[1],
  Bizarre = Bizarre[1],
  FormalThought = FormalThought[1],
  Flattening = Flattening[1],
  Avolition = Avolition[1],
  Anhedonia = Anhedonia[1],
  Attention = Attention[1],
  )

xxx <- merge(xxx,Demo,by.x ="ID",by.y = "Subject")

MultiVariateSANS_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + SANS +  (1|p|ID)
)

mSANS<- brm(MultiVariateSANS_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mSANS",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mSANS <- add_criterion(mSANS,criterion="loo",file="models/mSANS")

MultiVariateSANSmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(SANS) +  (1|p|ID)
)

mSANSmo<- brm(MultiVariateSANSmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mSANSmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mSANSmo <- add_criterion(mSANSmo,criterion="loo",file="models/mSANSmo")

MultiVariateSAPS_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + SAPS +  (1|p|ID)
)

mSAPS<- brm(MultiVariateSAPS_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mSAPS",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mSAPS <- add_criterion(mSAPS,criterion="loo",file="models/mSAPS")

MultiVariateSAPSmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(SAPS) +  (1|p|ID)
)

mSAPSmo <- brm(MultiVariateSAPSmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mSAPSmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mSAPSmo <- add_criterion(mSAPSmo,criterion="loo",file="models/mSAPSmo")

## PSP
MultiVariatePSP_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + PSP +  (1|p|ID)
)

mPSP<- brm(MultiVariatePSP_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mPSP <- add_criterion(mPSP,criterion="loo",file="models/mPSP")

MultiVariatePSPmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(PSP) +  (1|p|ID)
)

mPSPmo <- brm(MultiVariatePSPmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mPSPmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mPSPmo <- add_criterion(mPSPmo, criterion="loo", file="models/mPSPmo")

## Allucinations
MultiVariateAllucinations_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Hallucinations +  (1|p|ID)
)

mAllucinations<- brm(MultiVariateAllucinations_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file="models/mAllucinations",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAllucinations <- add_criterion(mAllucinations,criterion="loo",file="models/mAllucinations")

MultiVariateAllucinationsmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Hallucinations) +  (1|p|ID)
)

mAllucinationsmo <- brm(MultiVariateAllucinationsmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mAllucinationsmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAllucinationsmo <- add_criterion(mAllucinationsmo, criterion="loo", file="models/mAllucinationsmo")

## Delusions
MultiVariateDelusions_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Delusions +  (1|p|ID)
)

mDelusions<- brm(MultiVariateDelusions_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mDelusions <- add_criterion(mDelusions,criterion="loo",file="models/mDelusions")

MultiVariateDelusionsmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Delusions) +  (1|p|ID)
)


   mDelusionsmo <- brm(MultiVariateDelusionsmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mDelusionsmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mDelusionsmo <- add_criterion(mDelusionsmo, criterion="loo", file="models/mDelusionsmo")

## Bizarre
MultiVariateBizarre_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Bizarre +  (1|p|ID)
)

mBizarre<- brm(MultiVariateBizarre_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mBizarre <- add_criterion(mBizarre,criterion="loo",file="models/mBizarre")

MultiVariateBizarremo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Bizarre) +  (1|p|ID)
)

mBizarremo <- brm(MultiVariateBizarremo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mBizarremo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mBizarremo <- add_criterion(mBizarremo, criterion="loo", file="models/mBizarremo")

## FormalThought
MultiVariateFormalThought_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + FormalThought +  (1|p|ID)
)

mFormalThought<- brm(MultiVariateFormalThought_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mFormalThought <- add_criterion(mFormalThought,criterion="loo",file="models/mFormalThought")

MultiVariateFormalThoughtmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(FormalThought) +  (1|p|ID)
)

mFormalThoughtmo <- brm(MultiVariateFormalThoughtmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mFormalThoughtmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mFormalThoughtmo <- add_criterion(mFormalThoughtmo, criterion="loo", file="models/mFormalThoughtmo")

## Flattening
MultiVariateFlattening_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Flattening +  (1|p|ID)
)

mFlattening<- brm(MultiVariateFlattening_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mFlattening <- add_criterion(mFlattening,criterion="loo",file="models/mFlattening")

MultiVariateFlatteningmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Flattening) +  (1|p|ID)
)

mFlatteningmo <- brm(MultiVariateFlatteningmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mFlatteningmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mFlatteningmo <- add_criterion(mFlatteningmo, criterion="loo", file="models/mFlatteningmo")

## Avolition
MultiVariateAvolition_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Avolition +  (1|p|ID)
)

mAvolition<- brm(MultiVariateAvolition_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAvolition <- add_criterion(mAvolition,criterion="loo",file="models/mAvolition")

MultiVariateAvolitionmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Avolition) +  (1|p|ID)
)

mAvolitionmo <- brm(MultiVariateAvolitionmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mAvolitionmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAvolitionmo <- add_criterion(mAvolitionmo, criterion="loo", file="models/mAvolitionmo")

## Anhedonia
MultiVariateAnhedonia_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Anhedonia +  (1|p|ID)
)

mAnhedonia<- brm(MultiVariateAnhedonia_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAnhedonia <- add_criterion(mAnhedonia,criterion="loo",file="models/mAnhedonia")

MultiVariateAnhedoniamo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Anhedonia) +  (1|p|ID)
)

mAnhedoniamo <- brm(MultiVariateAnhedoniamo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mAnhedoniamo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAnhedoniamo <- add_criterion(mAnhedoniamo, criterion="loo", file="models/mAnhedoniamo")

## Attention
MultiVariateAttention_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Attention +  (1|p|ID)
)

mAttention<- brm(MultiVariateAttention_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAttention <- add_criterion(mAttention,criterion="loo",file="models/mAttention")

MultiVariateAttentionmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Attention) +  (1|p|ID)
)

mAttentionmo <- brm(MultiVariateAttentionmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mAttentionmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAttentionmo <- add_criterion(mAttentionmo, criterion="loo", file="models/mAttentionmo")

MultiVariateAllSAPS_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Hallucinations + Delusions + Bizarre + FormalThought +  (1|p|ID)
)

mAllSAPS<- brm(MultiVariateAllSAPS_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAllSAPS <- add_criterion(mAllSAPS,criterion="loo",file="models/mAllSAPS")

MultiVariateAllSAPSmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Hallucinations) + mo(Delusions) + mo(Bizarre) + mo(FormalThought) +  (1|p|ID)
)

mAllSAPSmo <- brm(MultiVariateAllSAPSmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mAllSAPSmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAllSAPSmo <- add_criterion(mAllSAPSmo, criterion="loo", file="models/mAllSAPSmo")

MultiVariateAllSANS_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Flattening + Avolition + Anhedonia + Attention +  (1|p|ID)
)

mAllSANS<- brm(MultiVariateAllSANS_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAllSANS <- add_criterion(mAllSANS,criterion="loo",file="models/mAllSANS")

MultiVariateAllSANSmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Flattening) + mo(Avolition) + mo(Anhedonia) + mo(Attention) +  (1|p|ID)
)

mAllSANSmo <- brm(MultiVariateAllSANSmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mAllSANSmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAllSANSmo <- add_criterion(mAllSANSmo, criterion="loo", file="models/mAllSANSmo")

MultiVariateAll_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + Hallucinations + Delusions + Bizarre + FormalThought + Flattening + Avolition + Anhedonia + Attention +  (1|p|ID)
)

mAll<- brm(MultiVariateAll_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAll <- add_criterion(mAll,criterion="loo",file="models/mAll")

MultiVariateAllmo_f <- bf(
  mvbind(wSelf, wOther, aSelf, aOther) ~ 1 + mo(Flattening) + mo(Avolition) + mo(Anhedonia) + mo(Attention) + mo(Flattening) + mo(Avolition) + mo(Anhedonia) + mo(Attention) +  (1|p|ID)
)

mAllmo <- brm(MultiVariateAllmo_f,
         data = xxx,
         prior = prior,
         sample_prior = T,
         family = gaussian,
         file = "models/mAllmo",
         cores = 2,
         chains = 2,
        control = list(
          adapt_delta = 0.99,
          max_treedepth = 20
        ))

mAllmo <- add_criterion(mAllmo, criterion="loo", file="models/mAllmo")
## Compare
loo_model_weights(mSANS,mSANSmo) # Weight for MO 0.915
loo_model_weights(mSAPS,mSAPSmo) # Weight for MO 0.867
loo_model_weights(mPSP,mPSPmo) # Weight for MO 0.951

loo_model_weights(mAllucinations,mAllucinationsmo) # Weight for MO 1
loo_model_weights(mDelusions,mDelusionsmo) # Weight for MO 0.859
loo_model_weights(mBizarre,mBizarremo) # Weight for MO 1
loo_model_weights(mFormalThought,mFormalThoughtmo) # Weight for MO .49
loo_model_weights(mFlattening,mFlatteningmo) # Weight for MO 0.91
loo_model_weights(mAvolition,mAvolitionmo) # Weight for MO .69
loo_model_weights(mAnhedonia,mAnhedoniamo) # Weight for MO 0.74
loo_model_weights(mAttention,mAttentionmo) # Weight for MO .85

# No Pooled model shows reasonable effects of diagnosis in the expected directions
hypothesis(m,"wSelf_DiagnosisSchizophrenia > 0") #  0.22      0.14        0     0.44      17.87      0.95
hypothesis(m,"wOther_DiagnosisSchizophrenia < 0") # -0.22      0.16     -0.5     0.05      10.56     0.91
hypothesis(m,"aSelf_DiagnosisSchizophrenia > 0") # 0.44      0.14     0.21     0.66       1999         1
hypothesis(m,"aOther_DiagnosisSchizophrenia < 0") #  -0.32      0.13    -0.54     -0.1      89.91      0.99

hypothesis(mSANSmo,"wSelf_moSANS > 0", class="bsp") #  0.11      0.03     0.07     0.15        Inf         1
hypothesis(mSANSmo,"wOther_moSANS < 0", class="bsp") # -0.09      0.03    -0.13    -0.04       1999         1
hypothesis(mSANSmo,"aSelf_moSANS > 0", class="bsp") # 0.11      0.03     0.07     0.16        Inf         1
hypothesis(mSANSmo,"aOther_moSANS < 0", class="bsp") # -0.06      0.02     -0.1    -0.02     132.33      0.99

hypothesis(mSAPSmo,"wSelf_moSAPS > 0", class="bsp") # 0.13      0.04     0.07     0.19        Inf         1 
hypothesis(mSAPSmo,"wOther_moSAPS < 0", class="bsp") # -0.06      0.03    -0.12    -0.01      36.04      0.97 
hypothesis(mSAPSmo,"aSelf_moSAPS > 0", class="bsp") #  0.13      0.03     0.08     0.19        Inf         1 
hypothesis(mSAPSmo,"aOther_moSAPS < 0", class="bsp") # -0.07      0.03    -0.12    -0.03     332.33         1 

hypothesis(mPSPmo,"wSelf_moPSP > 0", class="bsp") # 0.04      0.01     0.03     0.06        Inf         1
hypothesis(mPSPmo,"wOther_moPSP < 0", class="bsp") #  -0.03      0.01    -0.04    -0.01     332.33         1
hypothesis(mPSPmo,"aSelf_moPSP > 0", class="bsp") # 0.03      0.01     0.02     0.05       1999         1 
hypothesis(mPSPmo,"aOther_moPSP < 0", class="bsp") # -0.02      0.01    -0.03    -0.01     165.67      0.99 

# Specific symptoms
hypothesis(mAllucinationsmo,"wSelf_moHallucinations > 0", class="bsp") #  0.17      0.08     0.03     0.31      54.56      0.98
hypothesis(mAllucinationsmo,"wOther_moHallucinations < 0", class="bsp") # -0.1      0.07    -0.21     0.01      12.16      0.92 
hypothesis(mAllucinationsmo,"aSelf_moHallucinations > 0", class="bsp") #  0.21      0.08     0.08     0.34        249         1 
hypothesis(mAllucinationsmo,"aOther_moHallucinations < 0", class="bsp") # -0.1      0.06    -0.21        0      18.61      0.95

hypothesis(mDelusionsmo,"wSelf_moDelusions > 0", class="bsp") #  0.23      0.08     0.11     0.36        Inf         1
hypothesis(mDelusionsmo,"wOther_moDelusions < 0", class="bsp") # -0.1      0.07    -0.23        0      18.05      0.95  
hypothesis(mDelusionsmo,"aSelf_moDelusions > 0", class="bsp") #  0.2      0.07      0.1     0.32        499         1 
hypothesis(mDelusionsmo,"aOther_moDelusions < 0", class="bsp") # -0.13      0.06    -0.23    -0.03      75.92      0.99

hypothesis(mBizarremo,"wSelf_moBizarre > 0", class="bsp") #  0.32      0.13      0.1     0.54     110.11      0.99
hypothesis(mBizarremo,"wOther_moBizarre < 0", class="bsp") # -0.05      0.14    -0.27     0.17       1.99      0.67  
hypothesis(mBizarremo,"aSelf_moBizarre > 0", class="bsp") #  0.28      0.14     0.05     0.51      56.14      0.98 
hypothesis(mBizarremo,"aOther_moBizarre < 0", class="bsp") #  -0.25      0.11    -0.44    -0.08     110.11      0.99

hypothesis(mFormalThought,"wSelf_FormalThought > 0", class="b") #  -0.11      0.15    -0.35     0.13       0.28      0.22
hypothesis(mFormalThought,"wOther_FormalThought < 0", class="b") # 0.06      0.12    -0.13     0.24       0.45      0.31  
hypothesis(mFormalThought,"aSelf_FormalThought > 0", class="b") #  0.01      0.15    -0.23     0.25       1.07      0.52 
hypothesis(mFormalThought,"aOther_FormalThought < 0", class="b") # 0.01      0.11    -0.18     0.19       0.82      0.45

hypothesis(mFlatteningmo,"wSelf_moFlattening > 0", class="bsp") #   0.28      0.09     0.13     0.43        499         1
hypothesis(mFlatteningmo,"wOther_moFlattening < 0", class="bsp") # -0.26      0.09    -0.42    -0.11        499         1 
hypothesis(mFlatteningmo,"aSelf_moFlattening > 0", class="bsp") #  0.3      0.11     0.12     0.49     332.33         1  
hypothesis(mFlatteningmo,"aOther_moFlattening < 0", class="bsp") #  -0.18      0.08    -0.33    -0.05         99      0.99

hypothesis(mAvolitionmo,"wSelf_moAvolition > 0", class="bsp") #  0.29      0.09     0.16     0.44        Inf         1
hypothesis(mAvolitionmo,"wOther_moAvolition < 0", class="bsp") # -0.23      0.08    -0.37    -0.11        249         1 
hypothesis(mAvolitionmo,"aSelf_moAvolition > 0", class="bsp") #  0.24       0.1     0.09      0.4        249         1
hypothesis(mAvolitionmo,"aOther_moAvolition < 0", class="bsp") #  -0.12      0.08    -0.25     0.01      16.86      0.94

hypothesis(mAnhedoniamo,"wSelf_moAnhedonia > 0", class="bsp") #   0.23      0.08      0.1     0.37        499         1 
hypothesis(mAnhedoniamo,"wOther_moAnhedonia < 0", class="bsp") #   -0.23      0.08    -0.36    -0.11       1999         1
hypothesis(mAnhedoniamo,"aSelf_moAnhedonia > 0", class="bsp") #   0.23      0.09     0.08     0.39        199         1
hypothesis(mAnhedoniamo,"aOther_moAnhedonia < 0", class="bsp") #   -0.1      0.07    -0.22        0      16.86      0.94

hypothesis(mAttentionmo,"wSelf_moAttention > 0", class="bsp") #  0.27      0.11      0.1     0.47     165.67      0.99
hypothesis(mAttentionmo,"wOther_moAttention < 0", class="bsp") #   -0.14      0.08    -0.28    -0.01      28.85      0.97
hypothesis(mAttentionmo,"aSelf_moAttention > 0", class="bsp") #   0.28       0.1     0.12     0.45        399         1
hypothesis(mAttentionmo,"aOther_moAttention < 0", class="bsp") #  -0.09      0.08    -0.21     0.05        7.1      0.88

loo_model_weights(mAllucinationsmo,mDelusionsmo,mFormalThoughtmo,mBizarremo,mAllSAPSmo)
#                 weight
#mAllucinationsmo 0.000 
#mDelusionsmo     0.054 
#mFormalThoughtmo 0.000 
#mBizarremo       0.946 
#mAllSAPSmo       0.000 
loo_model_weights(mFlatteningmo,mAvolitionmo,mAnhedoniamo,mAttentionmo,mAllSANSmo)
#              weight
#mFlatteningmo 0.646 
#mAvolitionmo  0.170 
#mAnhedoniamo  0.000 
#mAttentionmo  0.184 
#mAllSANSmo    0.000 

# Correlation matrix

SymptomsCor_f <- bf(
  mvbind(Hallucinations,Delusions,Bizarre,FormalThought,Flattening,Avolition,Anhedonia,Attention,SANS,SAPS,PSP) ~ 1 + (1|p|Subject)
) 

get_prior(SymptomsCor_f,data=Demo,family=cumulative("logit"), threshold="flexible")

prior <- c(
  prior(lkj(5),class=cor),
  prior(normal(0,.3),class=Intercept),
  prior(normal(0,.3),class=sd,resp=Hallucinations),
  prior(normal(0,.3),class=sd,resp=Delusions),
  prior(normal(0,.3),class=sd,resp=Bizarre),
  prior(normal(0,.3),class=sd,resp=FormalThought),
  prior(normal(0,.3),class=sd,resp=Flattening),
  prior(normal(0,.3),class=sd,resp=Avolition),
  prior(normal(0,.3),class=sd,resp=Anhedonia),
  prior(normal(0,.3),class=sd,resp=Attention),
  prior(normal(0,.3),class=sd,resp=SANS),
  prior(normal(0,.3),class=sd,resp=SAPS),
  prior(normal(0,.3),class=sd,resp=PSP)
)


prior2 <- c(
  prior(lkj(5),class=cor)
  )



DemoD <- Demo %>% subset(Subject < 200)
DemoD$Hallucinations <- as.numeric(as.factor(DemoD$Hallucinations))
DemoD$Delusions <- as.numeric(as.factor(DemoD$Delusions))
DemoD$Bizarre <- as.numeric(as.factor(DemoD$Bizarre))
DemoD$FormalThought <- as.numeric(as.factor(DemoD$FormalThought))
DemoD$Avolition <- as.numeric(as.factor(DemoD$Avolition))
DemoD$Anhedonia <- as.numeric(as.factor(DemoD$Anhedonia))
DemoD$Flattening <- as.numeric(as.factor(DemoD$Flattening))
DemoD$Attention <- as.numeric(as.factor(DemoD$Attention))
DemoD$SANS <- as.numeric(as.factor(DemoD$SANS))
DemoD$SAPS <- as.numeric(as.factor(DemoD$SAPS))
DemoD$PSP <- as.numeric(as.factor(DemoD$PSP))
DemoD[,c("Hallucinations","Delusions","Bizarre","FormalThought","Flattening","Avolition","Anhedonia","Attention","SANS","SAPS","PSP")] <- DemoD[,c("Hallucinations","Delusions","Bizarre","FormalThought","Flattening","Avolition","Anhedonia","Attention","SANS","SAPS","PSP")] + 1


SymptomsCor_m <- brm(
  SymptomsCor_f,
  family=cumulative("logit"),
  data = DemoD,
  #prior = prior(lkj(5), class = cor),
  #sample_prior = T,
  cores=2,chains=2,
  iter=8000,
  control=list(adapt_delta=0.99,max_treedepth=20),
  file = "models/SymptomsCor6"
)

summary(SymptomsCor_m)
SymptomsCor_m <- add_criterion(SymptomsCor_m, criterion = "loo", file="models/SymptomsCor6")
```

## Control analysis 5: what if we include a heuristic model


```{r}
## heuristic
### If self is .5 (4 and 4 marbles), then look at others, otherwise nope
full_data$HeuristicSelf <- ifelse(full_data$Self==0.5,1,0)
full_data$HeuristicOther <- ifelse(full_data$Others>0.5,1,ifelse(full_data$Others<0.5,-1,0))

heuristic_diagnosis_f = bf(ChoiceRed ~ bias + 
             bSelf * Self + 
             HeuristicSelf * (bOthers * HeuristicOther),
             bSelf + bOthers + bias ~ 1 + Diagnosis + (1+Diagnosis|SubjectPair) ,
             nl = TRUE)

heuristic_prior = c(
  prior(normal(0, .1), nlpar = "bias"),
  prior(normal(0, 1), nlpar = "bSelf"),
  prior(normal(0, 1), nlpar = "bOthers"),
  prior(normal(0, .1), nlpar = "bias", class="sd"),
  prior(normal(0, .5), nlpar = "bSelf", class="sd"),
  prior(normal(0, .5), nlpar = "bOthers", class="sd"))


heuristic_diagnosis_m = brm(heuristic_diagnosis_f,
             family="bernoulli",
             full_data,
             prior = heuristic_prior,
             sample_prior = TRUE,
             file="models/Heuristic_Diagnosis_m",
             chains = N_CORES, cores = N_CORES, iter = ITER,
             control = STAN_CONTROL)
heuristic_diagnosis_m <- add_criterion(heuristic_diagnosis_m,
                                     criterion=c("waic","loo","R2"), file = "models/heuristic_diagnosis_m")

loo_compare(circular_diagnosis_m, circular_noI_diagnosis_m, weighted_diagnosis_m, naive_diagnosis_m, glm_diagnosis_m, heuristic_diagnosis_m)
loo_model_weights(circular_diagnosis_m, circular_noI_diagnosis_m, weighted_diagnosis_m, naive_diagnosis_m, glm_diagnosis_m, heuristic_diagnosis_m)

loo_model_weights(circular_diagnosis_m, heuristic_diagnosis_m)

```


## Figures for the article

### Figure 2: Circular inference estimates by diagnosis

```{r}
circular_diagnosis_m<-readRDS("models/circular_diagnosis_m.RDS")
circular_noI_diagnosis_m<-readRDS("models/circular_noI_diagnosis_m.RDS")
glm_diagnosis_m<-readRDS("models/glm_diagnosis_m.RDS")
weighted_diagnosis_m<-readRDS("models/weighted_diagnosis_m.RDS")
naive_diagnosis_m<-readRDS("models/naive_diagnosis_m.RDS")
heuristic_diagnosis_m<-readRDS("models/Heuristic_diagnosis_m.RDS")
### First generate all posterior samples for loops and weights by matched pair: intercept and diagnosis effect.
post <- posterior_samples(circular_diagnosis_m)


bias <- c(post$b_bias_Intercept,
          post$b_bias_Intercept + post$b_bias_Diagnosis)

bConfidence <- c(post$b_bConfidence_Intercept,
                 post$b_bConfidence_Intercept + post$b_bConfidence_Diagnosis)

wSelf <- c(post$b_wSelf_Intercept, 
           post$b_wSelf_Intercept + post$b_wSelf_Diagnosis)

wOthers <- c(post$b_wOthers_Intercept, 
             post$b_wOthers_Intercept + post$b_wOthers_Diagnosis)

aSelf <- c(post$b_aSelf_Intercept,
           post$b_aSelf_Intercept + post$b_aSelf_Diagnosis)

aOthers <- c(post$b_aOthers_Intercept,
             post$b_aOthers_Intercept + post$b_aOthers_Diagnosis)


Diagnosis <- c(  rep(0,each=8000),  rep(1,each=8000)) 

xxx <- data.frame(Diagnosis=as.factor(Diagnosis),wSelf,wOthers,aSelf,aOthers,bias,bConfidence)

## Use the xxx dataset
Pars <- xxx %>% group_by(Diagnosis) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
## Merge to fulldata
d <- full_data
d$SANS_i0=NULL
d$SANS_noAttention_i0=NULL
d$SAPS_i0=NULL
d$PSP_i0=NULL
d$SAPSalt_i0=NULL
d$SANSalt_i0=NULL

# Summarize performance by group
Raw <-d %>% 
  group_by(Diagnosis,lSelf,lOthers1noC,Confidence1,lOthers2noC,Confidence2,lOthers3noC,Confidence3,lOthers4noC,Confidence4) %>%
  summarize(Red=mean(RedChoice))


F2 <- function(a_raw, L_raw, w_raw) {
  # weighting function in R
  a = exp(a_raw)
  L = exp(L_raw * a)
  w = inv_logit_scaled(w_raw, 0.5, 1)
  log((w * L + 1 - w)/((1 - w) * L + w))
}

d0 <- unique(d[,c('lOthers1noC','Confidence1','lOthers2noC','Confidence2','lOthers3noC','Confidence3','lOthers4noC','Confidence4')])
d0 <- d0 %>% mutate (Others = lOthers1noC*Confidence1 + lOthers2noC*Confidence2 + lOthers3noC*Confidence3 + lOthers4noC*Confidence4)
d0 <- d0[order(d0$Others),]

SocInfoLvls <- c("4 green high confidence",
  "3 green high confidence, 1 red low confidence",
  "4 green low confidence",
  "3 green high confidence, 1 red high confidence",
  "3 green low confidence, 1 red low confidence",
  "3 green high confidence, 2 red low confidence",
  "3 green low confidence, 1 red high confidence",
  "2 green low confidence, 2 red low confidence",
  "2 green high confidence, 2 red high confidence",
  "1 green high confidence, 3 red low confidence",
  "2 green low confidence, 2 red high confidence",
  "1 green low confidence, 3 red low confidence",
  "4 red low confidence",
  "1 green high confidence, 3 red high confidence",
  "1 green low confidence, 3 red high confidence",
  "4 red high confidence")

d0$SocialInformation <- factor(SocInfoLvls,levels = SocInfoLvls)

d1 <- expand.grid(
  lSelf=seq(-1.9459101,1.9459101,0.001),
  Diagnosis=c(0,1))

d1 <- merge(d0,d1,all=T)

d1 <- merge(d1,Pars, by="Diagnosis")
d1 <- d1 %>% mutate(
  y = bias + F2(0, lSelf + F2(aSelf, lSelf, wSelf) +
                  F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                  F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                  F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                  F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wSelf) +
    F2(0, lOthers1noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence1) +
    F2(0, lOthers2noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence2) +
    F2(0, lOthers3noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence3) +
    F2(0, lOthers4noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence4),
  Others = lOthers1noC*Confidence1 + lOthers2noC*Confidence2 + lOthers3noC*Confidence3 + lOthers4noC*Confidence4
)

#d1 <- merge(d1,Raw,all=T)

d1$Diagnosis[d1$Diagnosis==0]="Control"
d1$Diagnosis[d1$Diagnosis==1]="Schizophrenia"

CI_bySelf <- ggplot(d1,aes(lSelf,inv.logit(y),color=SocialInformation,group=SocialInformation))+
  geom_line(size=1)+
#  geom_point(aes(lSelf,Red))+
  theme_classic()+
  facet_wrap(.~Diagnosis)+
  xlab("Reds in sample")+
  ylab("Propensity to choose red") +
  scale_x_continuous(breaks=sort(unique(d$lSelf)),labels=seq(1,7,1))+
  guides(color=FALSE,group=FALSE)

CI_bySelf

# Now the opposite plot
d0 <- data.frame(lSelf = sort(unique(d$lSelf)))

IndInfoLvls <- c(
  "1 red, 7 green",
  "2 red, 6 green", 
  "3 red, 5 green",
  "4 red, 4 green", 
  "5 red, 3 green", 
  "6 red, 2 green",
  "7 red, 1 green")

d0$IndividualInformation <- factor(IndInfoLvls,levels=IndInfoLvls)

d2 <- expand.grid(
  lOthers=seq(-8.788898,8.788898,0.01),
  Diagnosis=c(0,1))

d2 <- merge(d0,d2,all=T)

d2 <- merge(d2,Pars, by="Diagnosis")

d2 <- d2 %>% mutate(
  y = bias + 
    F2(0, lSelf + F2(aSelf, lSelf, wSelf) +
                  F2(aOthers, lOthers, wOthers+bConfidence), wSelf) +
    F2(0, lOthers + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers, wOthers + bConfidence), wOthers + bConfidence))

d2$Diagnosis[d2$Diagnosis==0]="Control"
d2$Diagnosis[d2$Diagnosis==1]="Schizophrenia"

CI_byOthers <- ggplot(d2,aes(lOthers,inv.logit(y),color=IndividualInformation,group=IndividualInformation))+
  geom_line(size=1)+
  theme_classic()+
  facet_wrap(.~Diagnosis)+
  xlab("Evidence provided by Others")+
  ylab("Propensity to choose red")+
  guides(color=FALSE,group=FALSE)

CI_byOthers

ggarrange(CI_byOthers,CI_bySelf,nrow = 2)
```

## Figures for the supplementary materials

### Figure S1 - Illustrating effects of different weights on Weighted Bayes

```{r}

F1 <- function(a_raw, L_raw, w_raw) {
    # weighting function in R
    a = exp(a_raw)
    L = exp(L_raw * a)
    #w = inv_logit_scaled(w_raw, 0.5, 1)
    w = w_raw
    log((w * L + 1 - w)/((1 - w) * L + w))
}

simD <- expand.grid(x = seq(-3, 3, length.out = 100), 
            w = seq(0.5, 1, .1)) %>%
        mutate(out = F1(0,x, w),
               prob = inv.logit(out),
               evidence= inv.logit(x)) %>%
        mutate(w = as.factor(w))
  
  
weightPlot <- ggplot(simD,aes(x, prob, colour=w, group=w)) +
  geom_line() + 
  labs(y = "Probability of choosing red", x="Evidence for red") +
  theme_classic()

weightPlot

```

### Figure S2 - Illustrating effects of different loops on Circular Inference

```{r}

## First without interference

# 3 levels of loop: log(-1), log(0), log(1)

simD <- expand.grid(x = seq(-3, 3, length.out = 100), 
            w = seq(0.5, 1, .1)) %>%
        mutate(out = F1(-1,x, w),
               prob = inv.logit(out),
               evidence= inv.logit(x)) %>%
        mutate(w = as.factor(w))
  
  
LoopPlot0 <- ggplot(simD,aes(x, prob, colour=w, group=w)) +
  geom_line() + 
  labs(y = "Probability of choosing red", x="Self") +
  theme_classic()

simD <- expand.grid(x = seq(-3, 3, length.out = 100), 
            w = seq(0.5, 1, .1)) %>%
        mutate(out = F1(1,x, w),
               prob = inv.logit(out),
               evidence= inv.logit(x)) %>%
        mutate(w = as.factor(w))
  
  
LoopPlot2 <- ggplot(simD,aes(x, prob, colour=w, group=w)) +
  geom_line() + 
  labs(y = "Probability of choosing red", x="Self") +
  theme_classic()

simD <- expand.grid(x = seq(-3, 3, length.out = 100), 
            w = seq(0.5, 1, .1)) %>%
        mutate(out = F1(0,x, w),
               prob = inv.logit(out),
               evidence= inv.logit(x)) %>%
        mutate(w = as.factor(w))
  
  
LoopPlot1 <- ggplot(simD,aes(x, prob, colour=w, group=w)) +
  geom_line() + 
  labs(y = "Probability of choosing red", x="Self") +
  theme_classic()

simD <- expand.grid(x = seq(-3, 3, length.out = 100), 
            w = seq(0.5, 1, .1)) %>%
        mutate(out = F1(1,x, w),
               prob = inv.logit(out),
               evidence= inv.logit(x)) %>%
        mutate(w = as.factor(w))
  
  
LoopPlot2 <- ggplot(simD,aes(x, prob, colour=w, group=w)) +
  geom_line() + 
  labs(y = "Probability of choosing red", x="Self") +
  theme_classic()

ggarrange(LoopPlot0,LoopPlot1 ,LoopPlot2,ncol=3)
ggsave("LoopPlots.svg")


## Then with interference
circular_f = bf(ChoiceRed ~ bias + 
                   F(0, lSelf + I, wSelf) +
                   F(0, lOthers1noC + I, wOthers + bConfidence * Confidence1) +
                   F(0, lOthers2noC + I, wOthers + bConfidence * Confidence2) +
                   F(0, lOthers3noC + I, wOthers + bConfidence * Confidence3) +
                   F(0, lOthers4noC + I, wOthers + bConfidence * Confidence4),
               wSelf + wOthers + aSelf + aOthers + bias + bConfidence ~ 1 + (1|p|Participant) ,
               nlf(I ~ F(aSelf, lSelf, wSelf) +
                          F(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                          F(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                          F(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                          F(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4)),
               nl = TRUE)

simD <- expand.grid(x = seq(-3, 3, length.out = 100), 
            w = seq(0.5, 1, .1)) %>%
        mutate(out = F1(-1,x, w),
               prob = inv.logit(out),
               evidence= inv.logit(x)) %>%
        mutate(w = as.factor(w))
  
  
LoopPlot0 <- ggplot(simD,aes(x, prob, colour=w, group=w)) +
  geom_line() + 
  labs(y = "Probability of choosing red", x="Self") +
  theme_classic()
```

### Figure S3 - Forest plot of weight and loop parameters by participant in CI

```{r}
load("models/circular_diagnosis_m")
### First generate all posterior samples for loops and weights by matched pair: intercept and diagnosis effect.
post <- posterior_samples(circular_diagnosis_m)
### I want a dataset with
#### Subject
#### Diagnosis
#### w Self
#### w Others
#### a Self
#### a Others
### Then sum random to fixed effect and create both control and patient

### Then select only existing participants
### We have all controls
### We only have the following patients unique(full_data$SubjectPair[full_data$Group=="1"])

### Then scale to correct scale

### Then plot

bias <- c(exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[1,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[2,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[3,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[4,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[5,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[6,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[7,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[8,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[9,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[10,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[11,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[12,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[13,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[14,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[15,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[16,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[17,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[18,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[19,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[20,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[21,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[22,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[23,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[24,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[25,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[26,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[27,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[28,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[29,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[30,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[31,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[32,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[33,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[34,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[35,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[36,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[37,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[38,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[39,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[40,Intercept]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[1,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[1,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[2,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[2,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[3,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[3,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[4,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[4,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[5,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[5,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[6,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[6,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[8,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[8,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[9,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[9,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[10,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[10,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[13,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[13,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[15,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[15,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[16,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[16,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[17,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[17,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[18,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[18,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[19,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[19,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[20,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[20,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[21,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[21,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[22,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[22,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[23,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[23,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[24,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[24,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[25,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[25,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[26,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[26,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[27,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[27,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[28,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[28,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[29,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[29,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[30,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[30,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[31,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[31,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[32,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[32,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[33,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[33,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[34,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[34,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[36,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[36,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[37,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[37,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[38,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[38,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[39,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[39,Diagnosis]`),
           exp(post$b_bias_Intercept + post$`r_SubjectPair__bias[40,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[40,Diagnosis]`))

bConfidence <- c(exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[1,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[2,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[3,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[4,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[5,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[6,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[7,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[8,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[9,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[10,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[11,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[12,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[13,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[14,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[15,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[16,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[17,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[18,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[19,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[20,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[21,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[22,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[23,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[24,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[25,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[26,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[27,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[28,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[29,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[30,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[31,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[32,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[33,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[34,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[35,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[36,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[37,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[38,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[39,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[40,Intercept]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[1,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[1,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[2,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[2,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[3,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[3,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[4,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[4,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[5,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[5,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[6,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[6,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[8,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[8,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[9,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[9,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[10,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[10,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[13,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[13,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[15,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[15,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[16,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[16,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[17,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[17,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[18,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[18,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[19,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[19,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[20,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[20,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[21,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[21,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[22,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[22,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[23,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[23,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[24,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[24,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[25,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[25,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[26,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[26,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[27,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[27,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[28,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[28,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[29,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[29,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[30,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[30,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[31,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[31,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[32,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[32,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[33,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[33,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[34,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[34,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[36,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[36,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[37,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[37,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[38,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[38,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[39,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[39,Diagnosis]`),
           exp(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[40,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[40,Diagnosis]`))

wSelf <- c(inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[1,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[2,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[3,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[4,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[5,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[6,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[7,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[8,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[9,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[10,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[11,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[12,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[13,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[14,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[15,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[16,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[17,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[18,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[19,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[20,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[21,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[22,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[23,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[24,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[25,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[26,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[27,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[28,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[29,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[30,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[31,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[32,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[33,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[34,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[35,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[36,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[37,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[38,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[39,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[40,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[1,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[1,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[2,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[2,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[3,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[3,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[4,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[4,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[5,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[5,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[6,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[6,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[8,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[8,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[9,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[9,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[10,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[10,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[13,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[13,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[15,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[15,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[16,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[16,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[17,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[17,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[18,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[18,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[19,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[19,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[20,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[20,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[21,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[21,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[22,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[22,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[23,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[23,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[24,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[24,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[25,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[25,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[26,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[26,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[27,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[27,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[28,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[28,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[29,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[29,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[30,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[30,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[31,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[31,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[32,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[32,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[33,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[33,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[34,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[34,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[36,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[36,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[37,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[37,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[38,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[38,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[39,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[39,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[40,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[40,Diagnosis]`, 0.5, 1))

wOthers <- c(inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[1,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[2,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[3,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[4,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[5,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[6,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[7,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[8,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[9,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[10,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[11,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[12,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[13,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[14,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[15,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[16,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[17,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[18,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[19,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[20,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[21,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[22,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[23,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[24,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[25,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[26,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[27,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[28,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[29,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[30,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[31,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[32,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[33,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[34,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[35,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[36,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[37,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[38,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[39,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[40,Intercept]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[1,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[1,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[2,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[2,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[3,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[3,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[4,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[4,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[5,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[5,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[6,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[6,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[8,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[8,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[9,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[9,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[10,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[10,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[13,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[13,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[15,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[15,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[16,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[16,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[17,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[17,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[18,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[18,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[19,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[19,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[20,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[20,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[21,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[21,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[22,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[22,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[23,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[23,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[24,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[24,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[25,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[25,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[26,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[26,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[27,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[27,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[28,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[28,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[29,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[29,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[30,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[30,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[31,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[31,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[32,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[32,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[33,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[33,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[34,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[34,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[36,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[36,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[37,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[37,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[38,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[38,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[39,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[39,Diagnosis]`, 0.5, 1),
           inv_logit_scaled(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[40,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[40,Diagnosis]`, 0.5, 1))

aSelf <- c(exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[1,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[2,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[3,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[4,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[5,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[6,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[7,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[8,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[9,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[10,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[11,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[12,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[13,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[14,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[15,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[16,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[17,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[18,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[19,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[20,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[21,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[22,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[23,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[24,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[25,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[26,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[27,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[28,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[29,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[30,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[31,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[32,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[33,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[34,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[35,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[36,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[37,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[38,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[39,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[40,Intercept]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[1,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[1,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[2,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[2,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[3,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[3,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[4,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[4,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[5,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[5,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[6,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[6,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[8,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[8,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[9,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[9,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[10,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[10,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[13,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[13,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[15,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[15,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[16,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[16,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[17,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[17,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[18,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[18,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[19,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[19,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[20,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[20,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[21,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[21,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[22,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[22,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[23,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[23,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[24,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[24,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[25,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[25,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[26,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[26,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[27,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[27,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[28,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[28,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[29,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[29,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[30,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[30,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[31,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[31,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[32,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[32,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[33,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[33,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[34,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[34,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[36,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[36,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[37,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[37,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[38,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[38,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[39,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[39,Diagnosis]`),
           exp(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[40,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[40,Diagnosis]`))

aOthers <- c(exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[1,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[2,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[3,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[4,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[5,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[6,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[7,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[8,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[9,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[10,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[11,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[12,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[13,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[14,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[15,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[16,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[17,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[18,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[19,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[20,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[21,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[22,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[23,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[24,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[25,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[26,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[27,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[28,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[29,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[30,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[31,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[32,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[33,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[34,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[35,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[36,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[37,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[38,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[39,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[40,Intercept]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[1,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[1,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[2,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[2,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[3,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[3,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[4,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[4,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[5,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[5,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[6,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[6,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[8,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[8,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[9,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[9,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[10,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[10,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[13,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[13,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[15,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[15,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[16,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[16,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[17,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[17,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[18,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[18,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[19,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[19,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[20,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[20,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[21,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[21,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[22,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[22,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[23,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[23,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[24,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[24,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[25,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[25,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[26,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[26,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[27,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[27,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[28,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[28,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[29,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[29,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[30,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[30,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[31,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[31,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[32,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[32,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[33,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[33,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[34,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[34,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[36,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[36,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[37,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[37,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[38,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[38,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[39,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[39,Diagnosis]`),
           exp(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[40,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[40,Diagnosis]`))

Subject<-rep(c(unique(full_data$SubjectPair[full_data$Group=="0"]),unique(full_data$SubjectPair[full_data$Group=="1"])),each=8000)
Diagnosis <- c(  rep(0,each=8000*40),  rep(1,each=8000*length(unique(full_data$SubjectPair[full_data$Group=="1"])))) 

xxx <- data.frame(Subject,Diagnosis=as.factor(Diagnosis),wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
xxx$ID=xxx$Subject
xxx$ID[xxx$Diagnosis==0]=xxx$ID[xxx$Diagnosis==0]+100
xxx$ID <- as.numeric(as.factor(xxx$ID))

ForestWself <- ggplot(xxx, aes(x = wSelf, y = ID, group=ID,fill=Diagnosis)) + geom_density_ridges(rel_min_height = 0.01)+theme_classic()
ggsave(ForestWself, file="ForestWself.svg", width=9,height=9)
ForestWothers <- ggplot(xxx, aes(x = wOthers, y = ID, group=ID,fill=Diagnosis)) + geom_density_ridges(rel_min_height = 0.01)+theme_classic()
ggsave(ForestWothers, file="ForestWothers.svg", width=9,height=9)
ForestAself <- ggplot(xxx, aes(x = aSelf, y = ID, group=ID,fill=Diagnosis)) + geom_density_ridges(rel_min_height = 0.01)+theme_classic()
ggsave(ForestAself, file="ForestAself.svg", width=9,height=9)
ForestAothers <- ggplot(xxx, aes(x = aOthers, y = ID, group=ID,fill=Diagnosis)) + geom_density_ridges(rel_min_height = 0.01)+theme_classic()
ggsave(ForestAothers, file="ForestAothers.svg", width=9,height=9)

ggpubr::ggarrange(ForestWself,ForestAself,ForestWothers,ForestAothers)
ggsave(file="ForestAll.svg", width=9,height=9)
```

### Figure S4 - CI plot by participant

```{r}
load("models/circular_diagnosis_m")
### First generate all posterior samples for loops and weights by matched pair: intercept and diagnosis effect.
post <- posterior_samples(circular_diagnosis_m)
### Then a dataset with
#### Subject
#### Diagnosis
#### w Self
#### w Others
#### a Self
#### a Others
### Then sum random to fixed effect and create both control and patient

### Then select only existing participants
### We have all controls
### We only have the following patients unique(full_data$SubjectPair[full_data$Group=="1"])

### Then scale to correct scale

### Then plot

bias <- c(post$b_bias_Intercept + post$`r_SubjectPair__bias[1,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[2,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[3,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[4,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[5,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[6,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[7,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[8,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[9,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[10,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[11,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[12,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[13,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[14,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[15,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[16,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[17,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[18,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[19,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[20,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[21,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[22,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[23,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[24,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[25,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[26,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[27,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[28,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[29,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[30,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[31,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[32,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[33,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[34,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[35,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[36,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[37,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[38,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[39,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[40,Intercept]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[1,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[1,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[2,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[2,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[3,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[3,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[4,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[4,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[5,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[5,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[6,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[6,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[8,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[8,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[9,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[9,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[10,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[10,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[13,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[13,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[15,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[15,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[16,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[16,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[17,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[17,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[18,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[18,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[19,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[19,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[20,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[20,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[21,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[21,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[22,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[22,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[23,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[23,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[24,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[24,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[25,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[25,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[26,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[26,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[27,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[27,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[28,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[28,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[29,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[29,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[30,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[30,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[31,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[31,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[32,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[32,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[33,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[33,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[34,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[34,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[36,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[36,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[37,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[37,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[38,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[38,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[39,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[39,Diagnosis]`,
          post$b_bias_Intercept + post$`r_SubjectPair__bias[40,Intercept]` + post$b_bias_Diagnosis + post$`r_SubjectPair__bias[40,Diagnosis]`)

bConfidence <- c(post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[1,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[2,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[3,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[4,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[5,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[6,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[7,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[8,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[9,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[10,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[11,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[12,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[13,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[14,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[15,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[16,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[17,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[18,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[19,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[20,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[21,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[22,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[23,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[24,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[25,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[26,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[27,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[28,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[29,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[30,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[31,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[32,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[33,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[34,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[35,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[36,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[37,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[38,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[39,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[40,Intercept]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[1,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[1,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[2,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[2,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[3,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[3,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[4,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[4,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[5,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[5,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[6,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[6,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[8,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[8,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[9,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[9,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[10,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[10,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[13,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[13,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[15,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[15,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[16,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[16,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[17,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[17,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[18,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[18,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[19,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[19,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[20,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[20,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[21,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[21,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[22,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[22,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[23,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[23,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[24,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[24,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[25,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[25,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[26,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[26,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[27,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[27,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[28,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[28,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[29,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[29,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[30,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[30,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[31,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[31,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[32,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[32,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[33,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[33,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[34,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[34,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[36,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[36,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[37,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[37,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[38,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[38,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[39,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[39,Diagnosis]`,
                 post$b_bConfidence_Intercept + post$`r_SubjectPair__bConfidence[40,Intercept]` + post$b_bConfidence_Diagnosis + post$`r_SubjectPair__bConfidence[40,Diagnosis]`)

wSelf <- c(post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[1,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[2,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[3,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[4,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[5,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[6,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[7,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[8,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[9,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[10,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[11,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[12,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[13,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[14,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[15,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[16,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[17,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[18,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[19,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[20,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[21,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[22,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[23,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[24,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[25,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[26,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[27,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[28,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[29,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[30,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[31,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[32,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[33,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[34,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[35,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[36,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[37,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[38,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[39,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[40,Intercept]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[1,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[1,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[2,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[2,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[3,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[3,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[4,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[4,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[5,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[5,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[6,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[6,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[8,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[8,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[9,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[9,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[10,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[10,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[13,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[13,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[15,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[15,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[16,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[16,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[17,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[17,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[18,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[18,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[19,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[19,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[20,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[20,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[21,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[21,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[22,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[22,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[23,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[23,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[24,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[24,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[25,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[25,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[26,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[26,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[27,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[27,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[28,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[28,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[29,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[29,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[30,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[30,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[31,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[31,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[32,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[32,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[33,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[33,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[34,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[34,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[36,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[36,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[37,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[37,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[38,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[38,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[39,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[39,Diagnosis]`, 
           post$b_wSelf_Intercept + post$`r_SubjectPair__wSelf[40,Intercept]` + post$b_wSelf_Diagnosis + post$`r_SubjectPair__wSelf[40,Diagnosis]`)

wOthers <- c(post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[1,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[2,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[3,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[4,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[5,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[6,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[7,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[8,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[9,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[10,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[11,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[12,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[13,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[14,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[15,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[16,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[17,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[18,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[19,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[20,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[21,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[22,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[23,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[24,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[25,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[26,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[27,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[28,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[29,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[30,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[31,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[32,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[33,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[34,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[35,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[36,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[37,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[38,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[39,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[40,Intercept]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[1,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[1,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[2,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[2,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[3,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[3,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[4,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[4,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[5,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[5,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[6,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[6,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[8,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[8,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[9,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[9,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[10,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[10,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[13,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[13,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[15,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[15,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[16,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[16,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[17,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[17,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[18,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[18,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[19,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[19,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[20,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[20,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[21,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[21,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[22,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[22,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[23,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[23,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[24,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[24,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[25,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[25,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[26,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[26,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[27,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[27,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[28,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[28,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[29,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[29,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[30,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[30,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[31,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[31,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[32,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[32,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[33,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[33,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[34,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[34,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[36,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[36,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[37,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[37,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[38,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[38,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[39,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[39,Diagnosis]`, 
             post$b_wOthers_Intercept + post$`r_SubjectPair__wOthers[40,Intercept]` + post$b_wOthers_Diagnosis + post$`r_SubjectPair__wOthers[40,Diagnosis]`)

aSelf <- c(post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[1,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[2,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[3,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[4,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[5,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[6,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[7,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[8,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[9,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[10,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[11,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[12,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[13,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[14,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[15,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[16,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[17,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[18,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[19,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[20,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[21,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[22,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[23,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[24,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[25,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[26,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[27,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[28,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[29,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[30,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[31,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[32,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[33,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[34,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[35,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[36,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[37,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[38,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[39,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[40,Intercept]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[1,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[1,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[2,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[2,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[3,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[3,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[4,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[4,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[5,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[5,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[6,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[6,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[8,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[8,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[9,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[9,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[10,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[10,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[13,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[13,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[15,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[15,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[16,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[16,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[17,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[17,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[18,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[18,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[19,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[19,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[20,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[20,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[21,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[21,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[22,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[22,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[23,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[23,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[24,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[24,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[25,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[25,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[26,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[26,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[27,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[27,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[28,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[28,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[29,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[29,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[30,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[30,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[31,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[31,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[32,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[32,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[33,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[33,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[34,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[34,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[36,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[36,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[37,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[37,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[38,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[38,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[39,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[39,Diagnosis]`,
           post$b_aSelf_Intercept + post$`r_SubjectPair__aSelf[40,Intercept]` + post$b_aSelf_Diagnosis + post$`r_SubjectPair__aSelf[40,Diagnosis]`)

aOthers <- c(post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[1,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[2,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[3,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[4,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[5,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[6,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[7,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[8,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[9,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[10,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[11,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[12,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[13,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[14,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[15,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[16,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[17,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[18,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[19,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[20,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[21,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[22,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[23,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[24,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[25,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[26,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[27,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[28,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[29,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[30,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[31,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[32,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[33,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[34,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[35,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[36,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[37,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[38,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[39,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[40,Intercept]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[1,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[1,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[2,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[2,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[3,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[3,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[4,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[4,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[5,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[5,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[6,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[6,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[8,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[8,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[9,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[9,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[10,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[10,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[13,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[13,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[15,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[15,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[16,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[16,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[17,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[17,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[18,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[18,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[19,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[19,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[20,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[20,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[21,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[21,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[22,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[22,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[23,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[23,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[24,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[24,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[25,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[25,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[26,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[26,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[27,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[27,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[28,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[28,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[29,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[29,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[30,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[30,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[31,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[31,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[32,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[32,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[33,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[33,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[34,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[34,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[36,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[36,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[37,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[37,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[38,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[38,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[39,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[39,Diagnosis]`,
             post$b_aOthers_Intercept + post$`r_SubjectPair__aOthers[40,Intercept]` + post$b_aOthers_Diagnosis + post$`r_SubjectPair__aOthers[40,Diagnosis]`)

Subject<-rep(c(unique(full_data$SubjectPair[full_data$Group=="0"]),unique(full_data$SubjectPair[full_data$Group=="1"])),each=8000)
Diagnosis <- c(  rep(0,each=8000*40),  rep(1,each=8000*length(unique(full_data$SubjectPair[full_data$Group=="1"])))) 

xxx <- data.frame(Subject,Diagnosis=as.factor(Diagnosis),wSelf,wOthers,aSelf,aOthers,bias,bConfidence)
xxx$ID=xxx$Subject
xxx$ID[xxx$Diagnosis==0]=xxx$ID[xxx$Diagnosis==0]+100
xxx$ID <- as.numeric(as.factor(xxx$ID))

## Use the xxx dataset
Pars <- xxx %>% group_by(Subject,ID,Diagnosis) %>% dplyr::summarize(wSelf=mean(wSelf),wOthers=mean(wOthers),aSelf=mean(aSelf),aOthers=mean(aOthers),bias=mean(bias),bConfidence=mean(bConfidence))
## Merge to fulldata
d <- merge(full_data,Pars, by.x=c("SubjectPair","Diagnosis"),by.y=c("Subject","Diagnosis"))
d$SANS_i0=NULL
d$SANS_noAttention_i0=NULL
d$SAPS_i0=NULL
d$PSP_i0=NULL
d$SAPSalt_i0=NULL
d$SANSalt_i0=NULL

F2 <- function(a_raw, L_raw, w_raw) {
  # weighting function in R
  a = exp(a_raw)
  L = exp(L_raw * a)
  w = inv_logit_scaled(w_raw, 0.5, 1)
  log((w * L + 1 - w)/((1 - w) * L + w))
}

d <- d %>% mutate(
  y = bias + F2(0, lSelf + F2(aSelf, lSelf, wSelf) +
                  F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
                  F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
                  F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
                  F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wSelf) +
    F2(0, lOthers1noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence1) +
    F2(0, lOthers2noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence2) +
    F2(0, lOthers3noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence3) +
    F2(0, lOthers4noC + F2(aSelf, lSelf, wSelf) +
         F2(aOthers, lOthers1noC, wOthers + bConfidence * Confidence1) +
         F2(aOthers, lOthers2noC, wOthers + bConfidence * Confidence2) +
         F2(aOthers, lOthers3noC, wOthers + bConfidence * Confidence3) +
         F2(aOthers, lOthers4noC, wOthers + bConfidence * Confidence4), wOthers + bConfidence * Confidence4),
  Others = lOthers1noC*Confidence1 + lOthers2noC*Confidence2 + lOthers3noC*Confidence3 + lOthers4noC*Confidence4
)

## Following ID
d$ID <- as.numeric(as.factor(d$Subject))
## Rename Others
d$SocialInformation <- as.factor(round(d$Others,2))
levels(d$SocialInformation) <- list(
  "4 red high confidence" = "8.79", 
  "3 red high confidence, 1 green low confidence" = "5.49", 
  "3 red high confidence, 1 green high confidence" = "4.39",
  "3 red low confidence, 1 green low confidence /n 2 red high confidence, 2 green low confidence"="2.2", 
  "3 red low confidence, 1 green high confidence"="1.1", 
  "2 red, 2 green, same confidence"="0", 
  "3 green low confidence, 1 red high confidence"="-1.1",
  "3 green low confidence, 1 red low confidence /n 2 green high confidence, 2 red low confidence"="-2.2", 
  "3 green high confidence, 1 red high confidence"="-4.39", 
  "3 green high confidence, 1 red low confidence"="-5.49",
  "4 green high confidence"="-8.79")

## Individual information
d$IndividualInformation <- as.factor(round(d$Self,2))
levels(d$IndividualInformation) <- list(
  "7 red, 1 green" = "0.88", 
  "6 red, 2 green" = "0.75", 
  "5 red, 3 green" = "0.62",
  "4 red, 4 green"="0.5", 
  "3 red, 5 green"="0.38",
  "2 red, 6 green" = "0.25",
  "1 red, 7 green"="0.12")


## Plot schizophrenia
d1<-subset(d,Diagnosis==1 & Subject!=134)
CI_byS_SO_schizo <- ggplot(d1,aes(Self,inv.logit(y),color=SocialInformation,group=SocialInformation))+
  geom_smooth(se=FALSE)+
  geom_point()+
  theme_classic()+
  facet_wrap(ID~.,ncol=4)+
  xlab("Reds in sample")+
  ylab("Propensity to choose red")

CI_byS_SO_schizo

d1<-subset(d,Diagnosis==0)
CI_byS_SO_ctrl <- ggplot(d1,aes(Self,inv.logit(y),color=SocialInformation,group=SocialInformation))+
  geom_smooth(se=FALSE)+
  geom_point()+
  theme_classic()+
  facet_wrap(ID~.,ncol=4)+
  xlab("Reds in sample")+
  ylab("Propensity to choose red")

CI_byS_SO_ctrl

ggpubr::ggarrange(CI_byS_SO_schizo,CI_byS_SO_ctrl,common.legend = TRUE, legend='right')
ggsave(file="CI_byS_SO.svg", width=19,height=15)

## Inverse plots
d1<-subset(d,Diagnosis==1 & Subject!=134)
CI_byS_OS_schizo <- ggplot(d1,aes(inv.logit(Others)*4,inv.logit(y),color=IndividualInformation,group=IndividualInformation))+
  geom_smooth(se=FALSE)+
  geom_point()+
  theme_classic()+
  facet_wrap(ID~.,ncol=4)+
  xlab("Others choosing red")+
  ylab("Propensity to choose red")

CI_byS_OS_schizo

d1<-subset(d,Diagnosis==0)
CI_byS_OS_ctrl <- ggplot(d1,aes(inv.logit(Others)*4,inv.logit(y),color=IndividualInformation,group=IndividualInformation))+
  geom_smooth(se=FALSE)+
  geom_point()+
  theme_classic()+
  facet_wrap(ID~.,ncol=4)+
  xlab("Others choosing red")+
  ylab("Propensity to choose red")

CI_byS_OS_ctrl

ggpubr::ggarrange(CI_byS_OS_schizo,CI_byS_OS_ctrl,common.legend = TRUE, legend='right')
ggsave(file="CI_byS_OS.svg", width=15,height=15)


```


